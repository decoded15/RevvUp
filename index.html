<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevvUp | Your AI Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Source+Code+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }
        .font-tech {
            font-family: 'Source-Code-Pro', monospace;
        }
        .page { display: none; }
        .page.active { display: flex; flex-direction: column; }

        .flashcard-container { perspective: 1000px; }
        .flashcard-inner { position: relative; width: 100%; height: 100%; transition: transform 0.7s; transform-style: preserve-3d; }
        .is-flipped { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2.5rem; text-align: center; border-radius: 1rem; }
        .flashcard-back { transform: rotateY(180deg); overflow-y: auto; }
        
        #card-back-text {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        .flashcard-back .code-window {
            margin-left: auto;
            margin-right: auto;
            text-align: left; /* Keep code left-aligned within its window */
        }

        .code-window {
            background-color: #1f2937; border-radius: 0.75rem; padding-top: 2.5rem;
            position: relative; text-align: left; overflow: hidden; margin-top: 1rem; width: 100%;
        }
        .code-window-header {
            position: absolute; top: 0; left: 0; right: 0; height: 2rem; background-color: #374151;
            display: flex; align-items: center; padding-left: 0.75rem;
        }
        .code-window-dot { height: 0.75rem; width: 0.75rem; border-radius: 9999px; margin-right: 0.5rem; }
        .code-window-dot.red { background-color: #ef4444; }
        .code-window-dot.yellow { background-color: #f59e0b; }
        .code-window-dot.green { background-color: #10b981; }
        .code-window pre {
            background-color: transparent; margin: 0; padding: 1rem 1rem 2.5rem 1rem; /* Added padding-bottom for copy button */
            white-space: pre-wrap;
            font-size: 0.9em; color: #d1d5db;
        }
        
        #bookmark-btn svg {
            transition: transform 0.2s ease-in-out;
        }
        #bookmark-btn:hover svg {
            transform: scale(1.2);
        }
        #bookmark-btn.bookmarked svg {
            fill: #f59e0b;
            stroke: #f59e0b;
        }

        /* Modals */
        .modal {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        /* General Code Styling */
        .cheatsheet-content code, .flashcard-back code, #explanation-content code {
            color: #fcd34d; /* amber-300 */
            font-family: 'Source Code Pro', monospace;
            font-weight: 600;
            background-color: #374151;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }
        
        .code-window code {
            color: inherit;
            background-color: transparent;
            padding: 0;
            font-weight: normal; 
        }

        .cheatsheet-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            color: #22d3ee; /* cyan-400 */
        }
        .cheatsheet-content p {
            margin-bottom: 0.5rem;
            color: #d1d5db; /* gray-300 */
        }
        .cheatsheet-content .code-window {
             margin-top: 0.5rem;
             margin-bottom: 1rem;
        }
        .cheatsheet-content table {
            width: 100%;
            margin-top: 1rem;
            border-collapse: collapse;
        }
        .cheatsheet-content th, .cheatsheet-content td {
            border: 1px solid #4b5563; /* gray-600 */
            padding: 0.75rem;
            text-align: left;
        }
         .cheatsheet-content th {
            background-color: #374151; /* gray-700 */
         }

        /* Quiz Styles */
        .option-btn {
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .option-btn.correct {
            background-color: #10b981 !important; /* green-500 */
            border-color: #059669 !important; /* green-600 */
            transform: scale(1.05);
            color: #fff !important;
        }
        .option-btn.incorrect {
             background-color: #ef4444 !important; /* red-500 */
             border-color: #dc2626 !important; /* red-600 */
             color: #fff !important;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* Speedometer */
        .speedometer-container {
            width: 280px;
            height: 140px;
            position: relative;
            overflow: hidden;
        }
        .speedometer-bg {
            width: 280px;
            height: 140px;
            border-radius: 140px 140px 0 0;
            background: conic-gradient(from -90deg, #ef4444, #f59e0b, #10b981);
        }
        .speedometer-mask {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 240px;
            height: 120px;
            background: #111827;
            border-radius: 120px 120px 0 0;
        }
        .speedometer-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 4px;
            height: 120px;
            background: #67e8f9;
            transform-origin: bottom center;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1);
            transform: translateX(-50%) rotate(-90deg);
            border-radius: 2px;
            box-shadow: 0 0 10px #67e8f9;
        }

        /* Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Animations & Gradients */
        .animated-btn {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            background-size: 200% auto;
        }
        .animated-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
            background-position: right center;
        }
        .animated-btn:active {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 5px 10px rgba(0,0,0,0.19), 0 3px 3px rgba(0,0,0,0.23);
        }
        
        .btn-cyan {
            background-image: linear-gradient(to right, #22d3ee 0%, #06b6d4 51%, #22d3ee 100%);
        }
        .btn-amber {
            background-image: linear-gradient(to right, #fcd34d 0%, #f59e0b 51%, #fcd34d 100%);
        }
        .btn-green {
            background-image: linear-gradient(to right, #4ade80 0%, #22c55e 51%, #4ade80 100%);
        }
        .btn-gray {
            background-image: linear-gradient(to right, #6b7280 0%, #4b5563 51%, #6b7280 100%);
        }
        .btn-red {
             background-image: linear-gradient(to right, #f87171 0%, #ef4444 51%, #f87171 100%);
        }

        @keyframes search-glow {
            0% { box-shadow: 0 0 5px rgba(56, 189, 248, 0.2); border-color: #38bdf8; }
            50% { box-shadow: 0 0 20px rgba(56, 189, 248, 0.6); border-color: #0ea5e9; }
            100% { box-shadow: 0 0 5px rgba(56, 189, 248, 0.2); border-color: #38bdf8; }
        }

        #topic-search-input {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .search-container:hover #topic-search-input {
            transform: scale(1.03);
            border-color: #38bdf8;
        }

        .search-container:focus-within #topic-search-input {
            transform: scale(1.03);
            animation: search-glow 2s linear infinite;
        }
        
        .search-container:hover svg {
            fill: #0ea5e9;
        }
        .copy-code-btn {
            transition: all 0.2s ease-in-out;
        }
        .copy-code-btn:hover {
            background-color: #374151;
            transform: scale(1.1);
        }

        /* Typing Animation */
        .typing-cursor {
            display: inline-block;
            width: 2px;
            background-color: #67e8f9;
            margin-left: 4px;
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { background-color: transparent }
            50% { background-color: #67e8f9; }
        }

    </style>
</head>
<body class="text-gray-200">

    <!-- App Container -->
    <div class="w-full max-w-3xl mx-auto p-4 min-h-screen flex flex-col justify-center">

        <!-- ===== Welcome Page ===== -->
        <div id="welcome-page" class="page active text-center justify-center">
            <h1 class="text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">
                <span class="font-tech">RevvUp</span>
            </h1>
            <p id="typing-subtitle" class="text-2xl text-gray-300 mt-4 font-tech h-8"></p>
            <button id="start-btn" class="mt-12 text-gray-900 font-bold py-3 px-10 rounded-lg shadow-lg shadow-cyan-500/20 animated-btn btn-cyan">
                Start Revising
            </button>
            <footer class="absolute bottom-6 left-1/2 -translate-x-1/2 text-center text-gray-600">
                <p class="font-tech text-base">Created with <span class="text-red-500">&hearts;</span> by Dibyansh</p>
            </footer>
        </div>

        <!-- ===== Language Selection Page ===== -->
        <div id="language-select-page" class="page justify-center">
             <h2 class="text-3xl font-bold text-center mb-8">Choose Your Language</h2>
            <div class="grid grid-cols-2 gap-6">
                <div class="language-card" data-lang="python">
                    <img src="https://www.svgrepo.com/show/374016/python.svg" class="w-20 h-20" alt="Python Logo">
                    <span class="mt-2 font-semibold">Python</span>
                </div>
                <div class="language-card" data-lang="javascript">
                    <img src="https://www.svgrepo.com/show/373703/js.svg" class="w-20 h-20" alt="JavaScript Logo">
                    <span class="mt-2 font-semibold">JavaScript</span>
                </div>
                <div class="language-card" data-lang="html">
                    <img src="https://www.svgrepo.com/show/373669/html.svg" class="w-20 h-20" alt="HTML5 Logo">
                    <span class="mt-2 font-semibold">HTML5</span>
                </div>
                <div class="language-card" data-lang="css">
                     <img src="https://www.svgrepo.com/show/373535/css.svg" class="w-20 h-20" alt="CSS3 Logo">
                    <span class="mt-2 font-semibold">CSS3</span>
                </div>
            </div>
             <button class="back-btn" data-target="welcome-page">&larr; Back to Home</button>
        </div>
        
        <!-- ===== Mode Selection Page ===== -->
        <div id="mode-select-page" class="page justify-center">
            <h2 class="text-3xl font-bold text-center mb-2">How do you want to revise <span id="selected-lang-mode-span" class="text-cyan-400"></span>?</h2>
            <p class="text-center text-gray-400 mb-8">Choose your challenge.</p>
            <div class="space-y-4">
                <div class="mode-card" data-mode="flashcards">
                    <h3 class="text-xl font-semibold">Flashcards</h3>
                    <p class="text-gray-400">Flip through cards to test your knowledge.</p>
                </div>
                <div class="mode-card" data-mode="cheatsheet">
                    <h3 class="text-xl font-semibold">Cheat Sheet</h3>
                    <p class="text-gray-400">Get a quick overview of key concepts.</p>
                </div>
                <div class="mode-card" data-mode="quiz">
                    <h3 class="text-xl font-semibold">Quiz Me!</h3>
                    <p class="text-gray-400">Take a quiz and earn XP.</p>
                </div>
                 <div class="mode-card" data-mode="analytics">
                    <h3 class="text-xl font-semibold">Analytics</h3>
                    <p class="text-gray-400">Track your learning progress.</p>
                </div>
            </div>
            <button class="back-btn" data-target="language-select-page">&larr; Change Language</button>
        </div>

        <!-- ===== Deck Selection Page (Flashcards) ===== -->
        <div id="deck-select-page" class="page justify-center">
            <h2 class="text-3xl font-bold text-center mb-4">Select a Topic</h2>
            <div class="flex justify-center space-x-4 mb-6">
                <button id="view-bookmarks-btn" class="text-gray-900 font-bold py-2 px-6 rounded-lg shadow-lg shadow-amber-500/20 animated-btn btn-amber">View Bookmarks</button>
                <button id="create-deck-nav-btn" class="text-gray-900 font-bold py-2 px-6 rounded-lg shadow-lg shadow-cyan-500/20 animated-btn btn-cyan">Create New Deck</button>
            </div>
            <div class="relative w-full max-w-lg mx-auto mb-6 search-container">
                <input type="text" id="topic-search-input" placeholder="Search for a topic..." class="w-full bg-gray-700 border border-gray-600 rounded-full py-3 pl-5 pr-12 text-white placeholder-gray-400 focus:outline-none transition-all duration-300">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 h-6 w-6 text-gray-400">
                    <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' class="transition-colors duration-300" style='fill: rgba(156, 163, 175, 1);'><path d='M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z'></path></svg>
                </div>
            </div>
            <div id="deck-list" class="space-y-6 w-full">
                <!-- Deck categories and cards will be dynamically inserted here -->
            </div>
            <button class="back-btn" data-target="mode-select-page">&larr; Change Mode</button>
        </div>

        <!-- ===== Flashcard Page ===== -->
        <div id="flashcard-page" class="page justify-center">
            <div class="w-full flex justify-end mb-2">
                <button id="bookmark-btn" title="Bookmark this card" class="p-2 rounded-full hover:bg-gray-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                    </svg>
                </button>
            </div>
             <div class="flashcard-container mx-auto w-full h-80 md:h-96">
                <div id="flashcard-inner" class="flashcard-inner cursor-pointer shadow-2xl shadow-cyan-500/10">
                    <div id="flashcard-front" class="flashcard-front bg-gray-800 border border-gray-700">
                        <p id="card-front-text" class="text-2xl md:text-3xl font-semibold font-tech"></p>
                    </div>
                    <div id="flashcard-back" class="flashcard-back bg-gray-900 border border-cyan-400">
                        <div id="card-back-content" class="w-full h-full flex flex-col items-center justify-center">
                            <div id="card-back-text" class="text-lg md:text-xl font-tech w-full"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="progress-indicator" class="text-center mt-6 text-gray-500 font-tech"></div>
            <div class="flex justify-between items-center mt-6 w-full max-w-md self-center">
                <button id="prev-btn" class="nav-btn animated-btn btn-gray">Prev</button>
                <button id="flip-btn" class="text-gray-900 font-bold py-4 px-10 rounded-lg shadow-lg shadow-cyan-500/20 animated-btn btn-cyan">Flip</button>
                <button id="next-btn" class="nav-btn animated-btn btn-gray">Next</button>
                <button id="next-deck-btn" class="text-white font-bold py-3 px-6 rounded-lg shadow-md animated-btn btn-green" style="display: none;">Next Deck &rarr;</button>
            </div>
            <button class="back-btn" data-target="deck-select-page">&larr; Change Topic</button>
        </div>
        
        <!-- ===== Bookmarks Page ===== -->
        <div id="bookmarks-page" class="page justify-center">
            <h2 class="text-3xl font-bold text-center mb-8">My Bookmarks for <span id="bookmarks-lang-span" class="text-cyan-400"></span></h2>
            <div id="bookmarks-list" class="space-y-4 w-full">
                <!-- Bookmarked cards will be dynamically inserted here -->
            </div>
            <button class="back-btn" data-target="deck-select-page">&larr; Back to Topics</button>
        </div>

        <!-- ===== Cheat Sheet Page ===== -->
        <div id="cheatsheet-page" class="page justify-center py-8">
            <div id="cheatsheet-content-wrapper" class="bg-gray-900/70 border border-gray-700 p-6 md:p-10 rounded-2xl w-full">
                <!-- Cheat sheet content will be loaded here -->
            </div>
            <button class="back-btn" data-target="mode-select-page">&larr; Change Mode</button>
        </div>
        
        <!-- ===== Quiz Deck Selection Page ===== -->
        <div id="quiz-deck-select-page" class="page justify-center items-center">
            <h2 class="text-3xl font-bold text-center mb-8">Select Quiz Difficulty</h2>
            <div class="space-y-4 w-full max-w-md">
                <div class="mode-card quiz-deck-btn" data-deck="beginner">
                    <h3 class="text-xl font-semibold">🟢 Beginner</h3>
                    <p class="text-gray-400">Test your knowledge on the basics.</p>
                </div>
                <div class="mode-card quiz-deck-btn" data-deck="intermediate">
                    <h3 class="text-xl font-semibold">🟡 Intermediate</h3>
                    <p class="text-gray-400">Challenge yourself with tougher concepts.</p>
                </div>
                <div class="mode-card quiz-deck-btn" data-deck="oop">
                    <h3 class="text-xl font-semibold">🔵 Object-Oriented Programming</h3>
                    <p class="text-gray-400">Focus on classes, objects, and more.</p>
                </div>
                 <div class="mode-card quiz-deck-btn" data-deck="marathon">
                    <h3 class="text-xl font-semibold">🏆 Marathon</h3>
                    <p class="text-gray-400">A mix of all topics!</p>
                </div>
            </div>
            <button class="back-btn" data-target="mode-select-page">&larr; Change Mode</button>
        </div>

        <!-- ===== Quiz Instructions Page ===== -->
        <div id="quiz-instructions-page" class="page justify-center items-center text-center">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-lg max-w-lg">
                <h2 class="text-3xl font-bold text-cyan-400 mb-4">Quiz Instructions</h2>
                <ul class="text-left space-y-3 text-gray-300">
                    <li>✔️ This quiz has <strong id="instr-total-questions" class="text-white"></strong> questions.</li>
                    <li>⏳ You have <strong class="text-white">20 minutes</strong> to complete the quiz.</li>
                    <li>➕ You get <strong class="text-green-400">+10 points</strong> for each correct answer.</li>
                    <li>➖ You lose <strong class="text-red-400">-3 points</strong> for each incorrect answer.</li>
                    <li>🎯 Total possible score: <strong id="instr-total-points" class="text-white"></strong> points.</li>
                    <li>🏆 To pass, you must score at least <strong class="text-cyan-400">70%</strong> (that's <strong id="instr-passing-score" class="text-cyan-400"></strong> points).</li>
                </ul>
                <button id="start-quiz-btn" class="mt-8 text-gray-900 font-bold py-3 px-10 rounded-lg shadow-lg animated-btn btn-cyan">
                    Start Quiz
                </button>
            </div>
        </div>

        <!-- ===== Live Quiz Page ===== -->
        <div id="live-quiz-page" class="page justify-center">
            <div class="w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-lg font-bold">Score: <span id="quiz-score">0</span></div>
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div id="quiz-timer" class="font-bold text-2xl text-cyan-400 font-tech">20:00</div>
                    </div>
                    <button id="end-quiz-btn" class="text-white font-semibold py-2 px-4 rounded-lg text-sm animated-btn btn-red">End Quiz</button>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <p class="text-gray-400 text-sm">Question <span id="quiz-question-number">1</span> of <span id="quiz-total-questions">25</span></p>
                    <div id="quiz-question-text" class="text-xl font-semibold my-4"></div>
                    <div id="quiz-options-container" class="space-y-3">
                        <!-- Options will be inserted here -->
                    </div>
                </div>
                <div id="quiz-feedback" class="text-center mt-4 h-6"></div>
            </div>
        </div>
        
        <!-- ===== Quiz Results Page ===== -->
        <div id="quiz-results-page" class="page justify-center items-center text-center">
            <h2 class="text-4xl font-bold mb-4">Quiz Complete!</h2>
            <div class="speedometer-container my-8">
                <div class="speedometer-bg"></div>
                <div class="speedometer-mask"></div>
                <div id="speedometer-needle" class="speedometer-needle"></div>
                <div class="absolute inset-0 flex flex-col justify-end items-center pb-4">
                     <span id="final-score-text" class="text-4xl font-bold text-cyan-400">0 / 0</span>
                </div>
            </div>
            <p id="final-time-taken" class="text-lg mt-2 font-tech"></p>
            <p id="final-message" class="text-xl text-gray-300 mt-4"></p>
            <button id="try-again-btn" class="mt-8 text-gray-900 font-bold py-3 px-10 rounded-lg shadow-lg animated-btn btn-cyan">
                Try Another Quiz
            </button>
        </div>

        <!-- ===== Analytics Page ===== -->
        <div id="analytics-page" class="page justify-center py-8">
            <div class="w-full">
                <h2 class="text-3xl font-bold text-center mb-8 text-cyan-400">My Progress</h2>
                <!-- Key Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-lg text-center">
                        <h3 class="text-lg text-gray-400">Avg. Quiz Score</h3>
                        <p id="avg-quiz-score" class="text-4xl font-bold text-cyan-400 mt-2">0%</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-lg text-center">
                        <h3 class="text-lg text-gray-400">Flashcards Reviewed</h3>
                        <p id="cards-reviewed" class="text-4xl font-bold text-cyan-400 mt-2">0</p>
                    </div>
                </div>
                <!-- Learning Curve -->
                <div class="bg-gray-800 p-6 rounded-lg mb-8">
                    <h3 class="text-xl font-semibold mb-4">Learning Curve</h3>
                    <canvas id="learning-curve-chart"></canvas>
                </div>
                <!-- Topic Mastery -->
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4">Topic Mastery</h3>
                    <div id="topic-mastery-container" class="space-y-4">
                        <!-- Mastery data will be injected here -->
                    </div>
                </div>
                <button class="back-btn" data-target="mode-select-page">&larr; Back to Modes</button>
            </div>
        </div>

        <!-- ===== Create Deck Page ===== -->
        <div id="create-deck-page" class="page justify-center py-8">
            <div class="w-full">
                <h2 class="text-3xl font-bold text-center mb-8 text-cyan-400">Create a Custom Deck</h2>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <input type="text" id="custom-deck-title" placeholder="Enter Deck Title" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 mb-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                    <div id="custom-cards-container" class="space-y-4">
                        <!-- Card input fields will be added here -->
                    </div>
                    <div class="flex justify-between mt-6">
                        <button id="add-card-btn" class="text-cyan-400 font-bold py-2 px-4 rounded-lg animated-btn btn-gray">+ Add Card</button>
                        <button id="save-deck-btn" class="text-gray-900 font-bold py-2 px-6 rounded-lg animated-btn btn-cyan">Save Deck</button>
                    </div>
                </div>
                 <button class="back-btn" data-target="deck-select-page">&larr; Back to Topics</button>
            </div>
        </div>


    </div>

    <script>
        // --- DATA ---
        function createCodeWindow(code) {
            // Important: Escape HTML characters to prevent rendering issues inside <pre><code>
            const escapedCode = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return `
                <div class="code-window">
                    <div class="code-window-header">
                        <span class="code-window-dot red"></span>
                        <span class="code-window-dot yellow"></span>
                        <span class="code-window-dot green"></span>
                    </div>
                    <pre><code>${escapedCode.trim()}</code></pre>
                    <button class="copy-code-btn absolute bottom-2 right-2 bg-gray-600 p-1.5 rounded-md">
                        <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' style='fill:white;'><path d='M20 2H10c-1.103 0-2 .897-2 2v4H4c-1.103 0-2 .897-2 2v10c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-4h4c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zM4 20V10h10l.002 10H4zm16-6h-4v-4c0-1.103-.897-2-2-2H10V4h10v10z'></path></svg>
                        <span class="copy-tooltip absolute -top-8 right-0 bg-gray-900 text-white text-xs px-2 py-1 rounded-md opacity-0 transition-opacity duration-300">Copied!</span>
                    </button>
                </div>
            `;
        }
        const allData = {
            python: {
                flashcards: {
                    "📦 Python Basics": [
                        { q: "What type of language is Python?", a: "Python is a high-level, interpreted, and dynamically-typed programming language." },
                        { q: "Who created Python and when?", a: "Python was created by Guido van Rossum and released in 1991." },
                        { q: "Is Python case-sensitive?", a: "Yes, Python is case-sensitive. <code>Print</code> and <code>print</code> are different." },
                        { q: "How do you execute a Python file from the terminal?", a: createCodeWindow(`python filename.py`) },
                        { q: "What is indentation in Python used for?", a: "Indentation is used to define blocks of code like in <code>if</code>, <code>for</code>, <code>while</code>, and functions." },
                        { q: "What is the default mode of Python shell?", a: "The interactive mode, also called the REPL (Read-Eval-Print Loop)." },
                        { q: "What symbol is used for single-line comments?", a: "The <code>#</code> symbol." },
                        { q: "How do you write a multi-line string in Python?", a: createCodeWindow(`'''Multi-line'''\n\n"""Also multi-line"""`) },
                        { q: "What function is used to take user input in Python?", a: "The <code>input()</code> function." },
                        { q: "How do you write Hello World in Python?", a: createCodeWindow(`print("Hello, World!")`) }
                    ],
                    "🔢 Variables & Data Types": [
                        { q: "How do you create a variable in Python?", a: `Assign a value directly using <code>=</code>` + createCodeWindow(`x = 5\nname = "Dibs"`) },
                        { q: "Do you need to declare data types in Python?", a: `No, Python automatically detects the type (it's dynamically typed).` + createCodeWindow(`a = 42        # int\nb = 3.14      # float\nc = "hello"   # str`)},
                        { q: "What are the basic data types in Python?", a: `<code>int</code>, <code>float</code>, <code>str</code>, and <code>bool</code>.` + createCodeWindow(`age = 20           # int\nprice = 19.99      # float\nname = "Dibs"      # str\nis_online = True   # bool`)},
                        { q: "What data type does <code>input()</code> return?", a: `Always a string (<code>str</code>), even for numbers.` + createCodeWindow(`user_input = input("Enter something: ")\nprint(type(user_input))  # Output: <class 'str'>`)},
                        { q: "How do you check the data type of a variable?", a: `Use the <code>type()</code> function.` + createCodeWindow(`x = 3.14\nprint(type(x))   # Output: <class 'float'>`)},
                        { q: "What does <code>isinstance()</code> do?", a: `Checks if a variable is of a specific type.` + createCodeWindow(`x = 10\nprint(isinstance(x, int))  # True`)},
                        { q: "How do you assign multiple values at once?", a: `Use comma-separated values on both sides.` + createCodeWindow(`a, b = 1, 2\nname, age = "Ommi", 18`)},
                        { q: "Can a variable change type in Python?", a: `Yes, Python allows dynamic typing.` + createCodeWindow(`x = 10\nx = "now I am a string"`)},
                        { q: "What is type casting?", a: `Converting one data type to another.` + createCodeWindow(`x = int("5")      # from str to int\ny = str(10)       # from int to str\nz = float("3.14") # from str to float`)},
                        { q: "What’s the difference between <code>=</code> and <code>==</code> in Python?", a: `<code>=</code> is for assignment, <code>==</code> is for comparison.` + createCodeWindow(`a = 5        # assignment\nprint(a == 5)  # comparison → True`)}
                    ], 
                    "➕ Operators": [
                        { q: "What are the different types of operators in Python?", a: "Arithmetic<br>Assignment<br>Comparison<br>Logical<br>Bitwise<br>Identity<br>Membership" },
                        { q: "What does the <code>+</code> operator do in Python?", a: "Adds numbers or concatenates strings" + createCodeWindow(`x = 5 + 3           # 8\ngreet = "Hi" + "!"  # "Hi!"`) },
                        { q: "What does the <code>**</code> operator do?", a: "Exponentiation (power)" + createCodeWindow(`result = 2 ** 3     # 8 (2 to the power 3)`) },
                        { q: "What’s the difference between <code>/</code> and <code>//</code>?", a: "<code>/</code> is float division; <code>//</code> is floor division" + createCodeWindow(`print(7 / 2)   # 3.5\nprint(7 // 2)  # 3`) },
                        { q: "What does <code>%</code> operator return?", a: "The remainder after division (modulus)" + createCodeWindow(`print(10 % 3)  # 1`) },
                        { q: "What does <code>==</code> check in Python?", a: "It checks if two values are equal" + createCodeWindow(`a = 10\nprint(a == 10)  # True`) },
                        { q: "What is the difference between <code>is</code> and <code>==</code>?", a: "<code>==</code> compares values, <code>is</code> compares identities (memory location)" + createCodeWindow(`a = [1, 2]\nb = [1, 2]\nprint(a == b)  # True\nprint(a is b)  # False`) },
                        { q: "What are the logical operators in Python?", a: "<code>and</code>, <code>or</code>, <code>not</code>" + createCodeWindow(`x = True\ny = False\nprint(x and y)  # False\nprint(x or y)   # True\nprint(not x)    # False`) },
                        { q: "How do assignment operators work in Python?", a: "They combine operation and assignment" + createCodeWindow(`x = 5\nx += 3  # same as x = x + 3 → x = 8`) },
                        { q: "What are membership operators in Python?", a: "<code>in</code> and <code>not in</code>, used to check if a value exists in a sequence" + createCodeWindow(`fruits = ["apple", "banana"]\nprint("apple" in fruits)     # True\nprint("mango" not in fruits) # True`) }
                    ], 
                    "🔀 Control Flow (if-elif-else)": [
                        { q: "What is the syntax of an <code>if</code> statement?", a: "Use <code>if</code> followed by a condition." + createCodeWindow(`if x > 0:\n    print("Positive")`) },
                        { q: "How do you write an <code>if-else</code> block?", a: createCodeWindow(`if x > 0:\n    print("Positive")\nelse:\n    print("Negative or zero")`) },
                        { q: "How do you write multiple conditions?", a: "Use <code>elif</code>." + createCodeWindow(`if x > 0:\n    print("Positive")\nelif x == 0:\n    print("Zero")\nelse:\n    print("Negative")`) },
                        { q: "What is the syntax for a one-liner <code>if</code> expression (ternary)?", a: "Use <code>value_if_true if condition else value_if_false</code>." + createCodeWindow(`result = "Even" if x % 2 == 0 else "Odd"`) },
                        { q: "How do you check multiple conditions together?", a: "Use <code>and</code>, <code>or</code>, <code>not</code>." + createCodeWindow(`if age > 18 and citizen:\n    print("Eligible")`) },
                        { q: "Can conditions be nested?", a: "Yes, you can write <code>if</code> inside another <code>if</code>." + createCodeWindow(`if x > 0:\n    if x < 10:\n        print("Single-digit positive")`) },
                        { q: "What values are considered <code>False</code> in conditions?", a: `<code>0</code>, <code>None</code>, <code>""</code>, <code>[]</code>, <code>{}</code>, <code>set()</code>.` },
                        { q: "What happens if you forget indentation?", a: "Python will raise an <code>IndentationError</code>." },
                        { q: "Can you compare multiple values using chained comparison?", a: "Yes." + createCodeWindow(`if 10 < x < 20:\n    print("x is between 10 and 20")`) },
                        { q: "What is the output of <code>bool(\"\")</code>?", a: "<code>False</code> — empty string is falsy." + createCodeWindow(`print(bool(""))  # False`) }
                    ], 
                    "🔄 Loops (for, while)": [
                        { q: "What is a <code>for</code> loop used for in Python?", a: "To iterate over a sequence (like list, tuple, string, range, etc)." + createCodeWindow(`for i in range(5):\n    print(i)`) },
                        { q: "How does a <code>while</code> loop work?", a: "It runs as long as the condition is <code>True</code>." + createCodeWindow(`x = 0\nwhile x < 5:\n    print(x)\n    x += 1`) },
                        { q: "What does <code>break</code> do in a loop?", a: "It exits the loop immediately." + createCodeWindow(`for i in range(10):\n    if i == 5:\n        break\n    print(i)`) },
                        { q: "What does <code>continue</code> do?", a: "It skips the current iteration and moves to the next one." + createCodeWindow(`for i in range(5):\n    if i == 2:\n        continue\n    print(i)`) },
                        { q: "What is the <code>else</code> clause in loops?", a: "It runs only if the loop completes normally (no <code>break</code>)." + createCodeWindow(`for i in range(3):\n    print(i)\nelse:\n    print("Done")`) },
                        { q: "Can we use <code>else</code> with <code>while</code> loop too?", a: "Yes, same behavior." },
                        { q: "How do you loop over a list with index?", a: "Use <code>enumerate()</code>." + createCodeWindow(`colors = ["red", "green"]\nfor index, color in enumerate(colors):\n    print(index, color)`) },
                        { q: "How do you loop over dictionary key-value pairs?", a: "Use <code>.items()</code>." + createCodeWindow(`d = {"a": 1, "b": 2}\nfor k, v in d.items():\n    print(k, v)`) },
                        { q: "How do you write an infinite loop?", a: createCodeWindow(`while True:\n    print("Looping forever")`) },
                        { q: "How do you reverse loop?", a: "Use <code>reversed()</code> or negative step in <code>range()</code>." + createCodeWindow(`for i in reversed(range(5)):\n    print(i)`) }
                    ], 
                    "ƒ Functions": [
                        { q: "How do you define a function in Python?", a: createCodeWindow(`def greet():\n    print("Hello!")`) },
                        { q: "How do you call a function?", a: "Use parentheses." + createCodeWindow(`greet()`) },
                        { q: "How do you define a function with parameters?", a: createCodeWindow(`def add(a, b):\n    return a + b`) },
                        { q: "What is a return value?", a: "The value a function sends back using <code>return</code>." },
                        { q: "What’s the default return value if not specified?", a: "<code>None</code>" },
                        { q: "What are keyword arguments?", a: "Arguments passed with <code>name=value</code>." + createCodeWindow(`def greet(name):\n    print("Hi", name)\n\ngreet(name="Dibs")`) },
                        { q: "What is <code>*args</code>?", a: "A way to pass variable number of positional arguments." + createCodeWindow(`def add(*nums):\n    return sum(nums)`) },
                        { q: "What is <code>**kwargs</code>?", a: "Used to pass variable number of keyword arguments." + createCodeWindow(`def show(**data):\n    print(data)\n\nshow(name="Dibs", age=18)`) },
                        { q: "What is a docstring?", a: "A string that documents a function. Use triple quotes." + createCodeWindow(`def f():\n    """This is a docstring"""`) },
                        { q: "Can functions call themselves?", a: "Yes, that’s recursion!" }
                    ], 
                    "📋 Lists": [
                        { q: "How do you define a list in Python?", a: "Using square brackets <code>[]</code>." + createCodeWindow(`fruits = ["apple", "banana", "cherry"]`) },
                        { q: "How do you access elements in a list?", a: "Using index positions (starting from 0)." + createCodeWindow(`print(fruits[1])  # banana`) },
                        { q: "How do you change an item in a list?", a: "Assign a new value using its index." + createCodeWindow(`fruits[0] = "grape"`) },
                        { q: "How do you add an item to the end of a list?", a: "Use <code>.append()</code>." + createCodeWindow(`fruits.append("orange")`) },
                        { q: "How do you insert an item at a specific index?", a: "Use <code>.insert(index, value)</code>." + createCodeWindow(`fruits.insert(1, "kiwi")`) },
                        { q: "How do you remove an item by value?", a: "Use <code>.remove(value)</code>." + createCodeWindow(`fruits.remove("banana")`) },
                        { q: "How do you delete an item by index?", a: "Use <code>del</code> or <code>.pop()</code>." + createCodeWindow(`del fruits[0]\n# or\nfruits.pop(2)`) },
                        { q: "How do you get the length of a list?", a: "Use <code>len()</code>." + createCodeWindow(`print(len(fruits))`) },
                        { q: "How do you loop through a list?", a: "Use a <code>for</code> loop." + createCodeWindow(`for fruit in fruits:\n    print(fruit)`) },
                        { q: "How do you check if an item exists in a list?", a: "Use the <code>in</code> keyword." + createCodeWindow(`if "apple" in fruits:\n    print("Found!")`) }
                    ], 
                    "🔗 Tuples": [
                        { q: "What is a tuple in Python?", a: "An immutable ordered collection." + createCodeWindow(`person = ("Alice", 25)`) },
                        { q: "How do you access elements in a tuple?", a: "Same as lists — with index." + createCodeWindow(`print(person[0])  # Alice`) },
                        { q: "How do you define a single-element tuple?", a: "Add a comma after the element." + createCodeWindow(`x = (5,)`) },
                        { q: "Can you modify a tuple after creation?", a: "No. Tuples are immutable." },
                        { q: "How do you unpack a tuple into variables?", a: "Assign it to multiple variables." + createCodeWindow(`name, age = person`) },
                        { q: "How do you loop through a tuple?", a: "Same as a list." + createCodeWindow(`for item in person:\n    print(item)`) },
                        { q: "How do you combine two tuples?", a: "Use the <code>+</code> operator." + createCodeWindow(`t1 = (1, 2)\nt2 = (3, 4)\nprint(t1 + t2)`) },
                        { q: "Can you slice a tuple?", a: "Yes. Just like lists." + createCodeWindow(`nums = (10, 20, 30, 40)\nprint(nums[1:3])  # (20, 30)`) },
                        { q: "What is the benefit of using tuples over lists?", a: "They are faster, use less memory, and are safe from modification." },
                        { q: "How do you check the type of a tuple?", a: "Use the <code>type()</code> function." + createCodeWindow(`print(type((1, 2)))  # <class 'tuple'>`) }
                    ], 
                    "📚 Dictionaries": [
                        { q: "What is a dictionary in Python?", a: "A collection of key:value pairs." + createCodeWindow(`person = {"name": "Ommi", "age": 20}`) },
                        { q: "How do you access a value in a dictionary?", a: "Use the key inside square brackets or <code>.get()</code>." + createCodeWindow(`print(person["name"])  # Ommi\nprint(person.get("age"))  # 20`) },
                        { q: "How do you change a value in a dictionary?", a: "Assign a new value to the key." + createCodeWindow(`person["age"] = 21`) },
                        { q: "How do you add a new key-value pair?", a: "Just assign it." + createCodeWindow(`person["gender"] = "male"`) },
                        { q: "How do you remove a key-value pair?", a: "Use <code>del</code> or <code>.pop()</code>." + createCodeWindow(`del person["age"]\n# OR\nperson.pop("gender")`) },
                        { q: "How do you loop through a dictionary?", a: "Use <code>.items()</code> for key-value pairs." + createCodeWindow(`for key, value in person.items():\n    print(key, value)`) },
                        { q: "How do you get only the keys or values?", a: "Use <code>.keys()</code> or <code>.values()</code>." + createCodeWindow(`person.keys()   # dict_keys(['name'])\nperson.values() # dict_values(['Ommi'])`) },
                        { q: "How do you check if a key exists?", a: "Use <code>in</code> keyword." + createCodeWindow(`"name" in person  # True`) },
                        { q: "Can dictionary keys be of any data type?", a: "Keys must be immutable types (e.g., string, number, tuple)." },
                        { q: "How do you clear all items from a dictionary?", a: "Use <code>.clear()</code>." + createCodeWindow(`person.clear()`) }
                    ], 
                    "✨ Sets": [
                        { q: "What is a set in Python?", a: "An unordered collection of unique elements." + createCodeWindow(`s = {1, 2, 3}`) },
                        { q: "How do you create an empty set?", a: "Use <code>set()</code> (not <code>{}</code> — that creates a dictionary!)." + createCodeWindow(`empty = set()`) },
                        { q: "How do you add an element to a set?", a: "Use <code>.add()</code> method." + createCodeWindow(`s.add(4)`) },
                        { q: "How do you remove an element from a set?", a: "Use <code>.remove()</code> or <code>.discard()</code>." + createCodeWindow(`s.remove(2)   # Raises error if not found\ns.discard(2)  # No error`) },
                        { q: "Can sets have duplicates?", a: "No, all items are unique." + createCodeWindow(`{1, 2, 2, 3}  # becomes {1, 2, 3}`) },
                        { q: "How do you check membership in a set?", a: "Use <code>in</code> keyword." + createCodeWindow(`2 in s  # True`) },
                        { q: "How do you find the union of two sets?", a: "Use <code>|</code> or <code>.union()</code>." + createCodeWindow(`a = {1, 2}; b = {2, 3}\nprint(a | b)  # {1, 2, 3}`) },
                        { q: "How do you find the intersection?", a: "Use <code>&</code> or <code>.intersection()</code>." + createCodeWindow(`print(a & b)  # {2}`) },
                        { q: "How do you find the difference?", a: "Use <code>-</code> or <code>.difference()</code>." + createCodeWindow(`print(a - b)  # {1}`) },
                        { q: "How do you clear all elements from a set?", a: "Use <code>.clear()</code>." + createCodeWindow(`s.clear()`) }
                    ], 
                    "✂️ String Manipulation": [
                        { q: "How do you define a string in Python?", a: "Use single <code>'</code> or double <code>\"</code> quotes." + createCodeWindow(`name = "Dibs"`) },
                        { q: "How do you access characters in a string?", a: "Use index (starting from 0)." + createCodeWindow(`print(name[0])  # D`) },
                        { q: "Are strings mutable in Python?", a: "No. Strings are immutable." },
                        { q: "How do you slice a string?", a: "Use <code>[start:end]</code>." + createCodeWindow(`print(name[1:3])  # "ib"`) },
                        { q: "How do you get the length of a string?", a: "Use <code>len()</code> function." + createCodeWindow(`print(len(name))  # 4`) },
                        { q: "How do you convert a string to uppercase/lowercase?", a: "Use <code>.upper()</code> or <code>.lower()</code>." + createCodeWindow(`print(name.upper())  # DIBS`) },
                        { q: "How do you replace parts of a string?", a: "Use <code>.replace(old, new)</code>." + createCodeWindow(`msg = "hello world"\nprint(msg.replace("world", "Dibs"))`) },
                        { q: "How do you remove whitespace from ends?", a: "Use <code>.strip()</code>." + createCodeWindow(`s = "  hey!  "\nprint(s.strip())  # "hey!"`) },
                        { q: "How do you check if a word is in a string?", a: "Use <code>in</code> keyword." + createCodeWindow(`"hello" in msg  # True`) },
                        { q: "How do you join a list of strings into one string?", a: "Use <code>.join()</code>." + createCodeWindow(`words = ["Python", "is", "fun"]\nprint(" ".join(words))`) }
                    ], 
                    "🔄 Type Casting": [
                        { q: "What is type casting in Python?", a: "Converting the value of one data type to another." + createCodeWindow(`x = int("5")  # string to integer`) },
                        { q: "How do you convert a float to an integer?", a: "Using <code>int()</code> function. It truncates the decimal part." + createCodeWindow(`int(3.99)  # Output: 3`) },
                        { q: "What happens when you convert a string that’s not a number using <code>int()</code>?", a: "A <code>ValueError</code> is raised." + createCodeWindow(`int("abc")  # ValueError`) },
                        { q: "Convert an integer to a string.", a: "Use <code>str()</code> function." + createCodeWindow(`str(123)  # Output: '123'`) },
                        { q: "How to convert a string to a float?", a: "Use <code>float()</code>" + createCodeWindow(`float("3.14")  # Output: 3.14`) },
                        { q: "Can you convert a string like \"5.0\" directly to int?", a: "No. First convert to float, then to int:" + createCodeWindow(`int(float("5.0"))  # Output: 5`) },
                        { q: "How to convert a list to a tuple?", a: "Use the <code>tuple()</code> function." + createCodeWindow(`tuple([1, 2, 3])`) },
                        { q: "How to convert a number to a boolean?", a: "<code>bool(0)</code> returns <code>False</code>, anything else returns <code>True</code>." + createCodeWindow(`bool(7)  # True`) },
                        { q: "Convert a list of strings to a list of integers.", a: "Use list comprehension:" + createCodeWindow(`nums = ["1", "2", "3"]\n[int(x) for x in nums]`) },
                        { q: "What is implicit type casting?", a: "Python automatically converts a value during an operation." + createCodeWindow(`a = 2 + 3.0  # Output: 5.0 (int + float = float)`) }
                    ], 
                    "⌨️ Input/Output": [
                        { q: "How do you take input from the user in Python?", a: "Use <code>input()</code> function." + createCodeWindow(`name = input("Enter your name: ")`) },
                        { q: "What is the return type of <code>input()</code>?", a: "Always returns a string." },
                        { q: "How do you convert user input to an integer?", a: "Use <code>int(input(...))</code>" + createCodeWindow(`age = int(input("Enter age: "))`) },
                        { q: "How to print multiple values in one line?", a: "Separate them with commas in <code>print()</code>" + createCodeWindow(`print("Age:", age)`) },
                        { q: "How do you customize the end of a print statement?", a: "Use the <code>end</code> argument." + createCodeWindow(`print("Hello", end="!")`) },
                        { q: "How do you format strings with variables?", a: "Use f-strings:" + createCodeWindow(`name = "Ommi"\nprint(f"Hello, {name}")`) },
                        { q: "How do you print without spaces in between items?", a: "Use <code>sep</code> argument:" + createCodeWindow(`print("Python", "C", "Java", sep="-")`) },
                        { q: "How do you take multiple inputs in one line?", a: "Use <code>.split()</code> method." + createCodeWindow(`a, b = input().split()`) },
                        { q: "How to print with 2 decimal places?", a: "Use formatted strings:" + createCodeWindow(`pi = 3.14159\nprint(f"{pi:.2f}")  # Output: 3.14`) },
                        { q: "How to get list of integers as input in one line?", a: "Use <code>map</code> and <code>split</code>:" + createCodeWindow(`nums = list(map(int, input().split()))`) }
                    ],
                    "📁 File Handling": [
                        { q: "How do you open a file in Python?", a: `Use <code>open()</code>. 'r' means read mode.` + createCodeWindow(`f = open("data.txt", "r")`)},
                        { q: "What are the different file modes in Python?", a: `<code>'r'</code>: Read (default)<br><code>'w'</code>: Write (overwrites)<br><code>'a'</code>: Append<br><code>'x'</code>: Create file<br><code>'b'</code>: Binary mode<br><code>'t'</code>: Text mode (default)`},
                        { q: "How do you read the content of a file?", a: createCodeWindow(`f = open("data.txt", "r")\ncontent = f.read()`)},
                        { q: "How do you read line by line?", a: `<code>f.readlines()</code> returns a list of lines.` + createCodeWindow(`f = open("data.txt", "r")\nlines = f.readlines()`)},
                        { q: "How to write into a file (overwrite mode)?", a: createCodeWindow(`f = open("data.txt", "w")\nf.write("Hello, world!")`)},
                        { q: "How to append to an existing file?", a: createCodeWindow(`f = open("data.txt", "a")\nf.write("\\nAnother line.")`)},
                        { q: "Why should you close a file after opening it?", a: `To free system resources and ensure data is properly written.`},
                        { q: "How to safely open files using <code>with</code> statement?", a: `It auto-closes the file.` + createCodeWindow(`with open("data.txt", "r") as f:\n    data = f.read()`)},
                        { q: "What does <code>seek()</code> do in file handling?", a: `Moves the file cursor to a specific byte position.` + createCodeWindow(`f.seek(0)  # Go back to the beginning`)},
                        { q: "How to read only the first line of a file?", a: createCodeWindow(`line = f.readline()`)},
                        { q: "What happens if the file doesn’t exist in 'r' mode?", a: `Python raises a <code>FileNotFoundError</code>.`},
                        { q: "What is the difference between <code>read()</code> and <code>readlines()</code>?", a: `<code>read()</code> → reads entire content as a string<br><code>readlines()</code> → returns a list of lines`},
                        { q: "How to write multiple lines at once?", a: createCodeWindow(`f.writelines(["Line1\\n", "Line2\\n"])`)},
                        { q: "How to check if a file exists before opening?", a: createCodeWindow(`import os\nos.path.exists("data.txt")`)},
                        { q: "What is binary file mode used for?", a: `Reading/writing non-text files like images or PDFs.` + createCodeWindow(`f = open("image.jpg", "rb")`)}
                    ], 
                    "⚠️ Error Handling (Exceptions)": [
                        { q: "What is error handling in Python?", a: `It’s the process of catching and managing exceptions during program execution.`},
                        { q: "What is the syntax of a basic <code>try-except</code> block?", a: createCodeWindow(`try:\n    x = 1 / 0\nexcept ZeroDivisionError:\n    print("Can't divide by zero!")`)},
                        { q: "What’s the purpose of <code>else</code> in error handling?", a: `Runs if no exception occurs.` + createCodeWindow(`try:\n    print("OK")\nexcept:\n    print("Error")\nelse:\n    print("No errors occurred")`)},
                        { q: "What is the use of <code>finally</code>?", a: `Executes always, whether an exception occurs or not.` + createCodeWindow(`finally:\n    print("Cleanup code")`)},
                        { q: "What’s the difference between <code>Exception</code> and <code>Error</code>?", a: `All errors are exceptions, but not all exceptions are programming bugs. <code>Exception</code> is the base class.`},
                        { q: "How to catch any exception without specifying the type?", a: createCodeWindow(`try:\n    ...\nexcept Exception as e:\n    print("Error:", e)`)},
                        { q: "Name a few common exceptions.", a: `<code>ZeroDivisionError</code><br><code>TypeError</code><br><code>FileNotFoundError</code><br><code>IndexError</code><br><code>ValueError</code>`},
                        { q: "What does <code>raise</code> do in Python?", a: `It manually throws an exception.` + createCodeWindow(`raise ValueError("Invalid input")`)},
                        { q: "Can you handle multiple exceptions?", a: `Yes:` + createCodeWindow(`try:\n    ...\nexcept (TypeError, ValueError) as e:\n    print(e)`)},
                        { q: "What is a custom exception?", a: `Your own exception class:` + createCodeWindow(`class MyError(Exception):\n    pass`)},
                        { q: "Why use specific exceptions instead of a general one?", a: `To handle errors more precisely and avoid catching unexpected issues.`},
                        { q: "What happens if an exception is not handled?", a: `The program crashes and shows a traceback error.`},
                        { q: "Use <code>try-except</code> for safe division.", a: createCodeWindow(`try:\n    x = int(input())\n    print(10 / x)\nexcept ZeroDivisionError:\n    print("Don't divide by zero!")`)},
                        { q: "Can <code>finally</code> be used without <code>except</code>?", a: `Yes:` + createCodeWindow(`try:\n    ...\nfinally:\n    print("Always runs")`)},
                        { q: "Can you nest <code>try-except</code> blocks?", a: `Yes, Python allows nested error handling for more control.`}
                    ], 
                    "📦 Modules & Packages": [
                        { q: "What is a module in Python?", a: `A module is a Python file (<code>.py</code>) containing functions, classes, or variables that can be imported into other programs.`},
                        { q: "How do you import a module?", a: createCodeWindow(`import math\nprint(math.sqrt(16))  # Output: 4.0`)},
                        { q: "What’s the difference between <code>import</code> and <code>from</code>?", a: `<b><code>import math</code></b> imports the entire module.<br><b><code>from math import sqrt</code></b> imports only the <code>sqrt</code> function.`},
                        { q: "How to rename a module while importing?", a: createCodeWindow(`import numpy as np\nprint(np.array([1, 2, 3]))`)},
                        { q: "What is <code>__name__ == \"__main__\"</code> used for?", a: `To ensure code runs only when a file is executed directly, not when imported as a module.`},
                        { q: "How to view all functions in a module?", a: `Use <code>dir()</code>:` + createCodeWindow(`import math\nprint(dir(math))`)},
                        { q: "What are built-in modules? Give examples.", a: `Pre-installed modules like <code>math</code>, <code>random</code>, <code>os</code>, <code>datetime</code>.`},
                        { q: "How do you create a custom module?", a: `Save a <code>.py</code> file with functions, then import it.` + createCodeWindow(`# mymodule.py\ndef greet(name):\n    return f"Hello, {name}"\n\n# main.py\nimport mymodule\nprint(mymodule.greet("Dibs"))`)},
                        { q: "What are packages in Python?", a: `Packages are directories containing multiple modules and an <code>__init__.py</code> file.`},
                        { q: "How do you import a function from a sub-package?", a: createCodeWindow(`from package.subpackage.module import function_name`)},
                        { q: "What does <code>__init__.py</code> do in a package?", a: `Marks the directory as a Python package. Can be empty or used to initialize the package.`},
                        { q: "How to list all installed modules/packages?", a: createCodeWindow(`pip list`)},
                        { q: "How to install external modules?", a: `With pip:` + createCodeWindow(`pip install requests`)},
                        { q: "How to uninstall a package?", a: createCodeWindow(`pip uninstall package_name`)},
                        { q: "Can a module contain classes and functions together?", a: `Yes. A module can have both classes and functions.`}
                    ], 
                    "λ Lambda, Map, Filter, Reduce": [
                        { q: "What is a lambda function?", a: "An anonymous, one-line function:" + createCodeWindow(`square = lambda x: x * x\nprint(square(5))  # Output: 25`) },
                        { q: "How is <code>lambda</code> different from <code>def</code>?", a: "<b><code>lambda</code></b>: one-liner, anonymous<br><b><code>def</code></b>: named, multiline, supports multiple statements" },
                        { q: "What does <code>map()</code> do?", a: "Applies a function to all items in an iterable:" + createCodeWindow(`nums = [1, 2, 3]\nsquares = list(map(lambda x: x**2, nums))`) },
                        { q: "Use <code>map()</code> with a built-in function.", a: createCodeWindow(`names = ["dibs", "ommi"]\ncapitalized = list(map(str.upper, names))`) },
                        { q: "What does <code>filter()</code> do?", a: "Filters elements based on a condition:" + createCodeWindow(`nums = [1, 2, 3, 4]\nevens = list(filter(lambda x: x % 2 == 0, nums))`) },
                        { q: "What does <code>reduce()</code> do?", a: "Combines items using a rolling computation." + createCodeWindow(`from functools import reduce\ntotal = reduce(lambda x, y: x + y, [1, 2, 3])`) },
                        { q: "Difference between <code>map()</code> and <code>filter()</code>?", a: "<b><code>map()</code></b>: transforms all items<br><b><code>filter()</code></b>: selects some items based on a condition" },
                        { q: "What does this return?", a: createCodeWindow(`list(map(lambda x: x*2, [1, 2, 3]))\n# Output: [2, 4, 6]`) },
                        { q: "Can lambdas have multiple arguments?", a: "Yes:" + createCodeWindow(`sum_two = lambda a, b: a + b`) },
                        { q: "Use <code>filter()</code> to remove empty strings.", a: createCodeWindow(`names = ["Dibs", "", "Ommi"]\nnon_empty = list(filter(None, names))`) },
                        { q: "Can <code>map</code> and <code>lambda</code> be replaced with list comprehension?", a: "Yes:" + createCodeWindow(`# map\nlist(map(lambda x: x**2, nums))\n\n# list comp\n[x**2 for x in nums]`) },
                        { q: "Why use <code>lambda</code> over <code>def</code> sometimes?", a: "For short, one-time functions — more concise and readable." },
                        { q: "Use <code>map()</code> with multiple iterables.", a: createCodeWindow(`a = [1, 2]\nb = [10, 20]\nlist(map(lambda x, y: x + y, a, b))  # Output: [11, 22]`) },
                        { q: "Use <code>reduce()</code> to find product of a list.", a: createCodeWindow(`from functools import reduce\nreduce(lambda x, y: x * y, [1, 2, 3, 4])  # Output: 24`) },
                        { q: "Can you assign a lambda to a variable?", a: "Yes:" + createCodeWindow(`double = lambda x: x * 2\nprint(double(3))  # Output: 6`) }
                    ], 
                    "⚡ List Comprehensions": [
                        { q: "What is list comprehension in Python?", a: "A concise way to create lists using a single line of code, often replacing for loops." },
                        { q: "Basic syntax of list comprehension?", a: createCodeWindow(`[expression for item in iterable]`) },
                        { q: "Example: Square of numbers from 0 to 4?", a: createCodeWindow(`squares = [x**2 for x in range(5)]`) },
                        { q: "Can list comprehension include <code>if</code> conditions?", a: "Yes. Syntax:" + createCodeWindow(`[expression for item in iterable if condition]`) },
                        { q: "Example: Even numbers from 0 to 10 using list comprehension?", a: createCodeWindow(`evens = [x for x in range(11) if x % 2 == 0]`) },
                        { q: "How to use <code>if-else</code> inside list comprehension?", a: "Use ternary syntax:" + createCodeWindow(`[true_expr if condition else false_expr for item in iterable]`) },
                        { q: "Example: Replace negative numbers with 0?", a: createCodeWindow(`nums = [-2, 3, -1, 5]\nresult = [x if x > 0 else 0 for x in nums]`) },
                        { q: "List comprehension with string manipulation?", a: createCodeWindow(`names = ["alice", "BOB", "Tom"]\nlower_names = [name.lower() for name in names]`) },
                        { q: "Can list comprehension be nested?", a: "Yes, for 2D structures:" + createCodeWindow(`matrix = [[1,2],[3,4]]\nflat = [num for row in matrix for num in row]`) },
                        { q: "How to create a list of tuples using list comprehension?", a: createCodeWindow(`pairs = [(x, y) for x in range(2) for y in range(2)]`) },
                        { q: "How to filter out <code>None</code> values using list comprehension?", a: createCodeWindow(`data = [1, None, 3]\ncleaned = [x for x in data if x is not None]`) },
                        { q: "Difference between list comprehension and generator expression?", a: "List comprehension returns a list, generator uses <code>()</code> and returns an iterator (lazy evaluation)." },
                        { q: "How to use <code>enumerate()</code> in list comprehension?", a: createCodeWindow(`data = ['a', 'b', 'c']\nindexed = [f\"{i}:{val}\" for i, val in enumerate(data)]`) },
                        { q: "Performance benefit of list comprehension?", a: "Faster than for loops due to optimized C-level implementation and less overhead." },
                        { q: "Use list comprehension to extract digits from a string?", a: createCodeWindow(`text = "a1b2c3"\ndigits = [int(ch) for ch in text if ch.isdigit()]`) }
                    ], 
                    "🌐 Scope (Global/Local)": [
                        { q: "What is scope in Python?", a: "Scope defines the region in which a variable is recognized and accessible." },
                        { q: "What is a local variable?", a: "A variable declared inside a function, accessible only within that function." },
                        { q: "What is a global variable?", a: "A variable declared outside all functions, accessible throughout the program." },
                        { q: "Example of a local variable?", a: createCodeWindow(`def greet():\n    name = "Alice"  # local\n    print(name)`) },
                        { q: "Example of a global variable?", a: createCodeWindow(`x = 5  # global\ndef show():\n    print(x)`) },
                        { q: "Can a local variable shadow a global one?", a: "Yes. A local variable with the same name overrides the global within its function." },
                        { q: "How to modify a global variable inside a function?", a: "Use the <code>global</code> keyword:" + createCodeWindow(`def change():\n    global x\n    x = 10`) },
                        { q: "What does the <code>global</code> keyword do?", a: "It tells Python that a variable inside a function refers to the global variable." },
                        { q: "What is the <code>nonlocal</code> keyword used for?", a: "Used to modify variables in the nearest enclosing scope (not global)." },
                        { q: "Example: Use of <code>nonlocal</code> in nested functions?", a: createCodeWindow(`def outer():\n    x = 10\n    def inner():\n        nonlocal x\n        x += 1\n    inner()\n    print(x)`) },
                        { q: "What is LEGB rule?", a: "It stands for Local → Enclosing → Global → Built-in — the order in which Python looks for variables." },
                        { q: "Can a global variable be read without using <code>global</code>?", a: "Yes, reading is allowed, but modifying requires the <code>global</code> keyword." },
                        { q: "What happens if you assign to a variable without <code>global</code> inside a function?", a: "Python treats it as a local variable, even if it shares a name with a global one." },
                        { q: "Example of built-in scope?", a: "Functions like <code>len()</code>, <code>max()</code>, and keywords like <code>True</code>, <code>False</code> exist in built-in scope." },
                        { q: "How to inspect variable scope?", a: "Use <code>globals()</code> and <code>locals()</code> to view current global and local symbol tables." }
                    ], 
                    "🔧 Built-in Functions": [
                        { q: "What does the <code>zip()</code> function do?", a: "Combines elements from multiple iterables into tuples." + createCodeWindow(`zip([1,2], ['a','b']) → [(1, 'a'), (2, 'b')]`) },
                        { q: "What is the use of the <code>any()</code> function?", a: "Returns <code>True</code> if any element in an iterable is <code>True</code>." + createCodeWindow(`any([0, False, 5]) → True`) },
                        { q: "What is the difference between <code>any()</code> and <code>all()</code>?", a: "<code>all()</code> returns <code>True</code> only if all elements are <code>True</code>." + createCodeWindow(`all([1, True, 5]) → True\nany([0, False]) → False`) },
                        { q: "What does <code>enumerate()</code> do?", a: "Adds a counter to an iterable." + createCodeWindow(`for i, val in enumerate(['a','b']): print(i,val)`) },
                        { q: "What does <code>eval()</code> do? Why should you be careful?", a: "Parses and runs a Python expression from a string. (Warning) Can execute malicious code if input isn't sanitized." + createCodeWindow(`eval("2 + 2") → 4`) },
                        { q: "How does <code>filter()</code> work?", a: "Filters items using a function that returns <code>True/False</code>." + createCodeWindow(`filter(lambda x: x > 0, [-1, 0, 1, 2]) → [1, 2]`) },
                        { q: "How is <code>map()</code> different from <code>filter()</code>?", a: "<code>map()</code> transforms items; <code>filter()</code> selects them." + createCodeWindow(`map(lambda x: x*2, [1, 2]) → [2, 4]`) },
                        { q: "What does <code>reversed()</code> do?", a: "Returns a reverse iterator." + createCodeWindow(`list(reversed([1,2,3])) → [3,2,1]`) },
                        { q: "What is <code>sorted()</code> used for?", a: "Returns a new sorted list (doesn't modify original)." + createCodeWindow(`sorted([3, 1, 2]) → [1, 2, 3]`) },
                        { q: "How does <code>isinstance()</code> help?", a: "Checks if an object is an instance of a type." + createCodeWindow(`isinstance(5, int) → True`) },
                        { q: "What does <code>len()</code> return?", a: "The number of items in a container." + createCodeWindow(`len("abc") → 3`) },
                        { q: "When do you use <code>type()</code>?", a: "To get the type of an object." + createCodeWindow(`type([1,2]) → <class 'list'>`) },
                        { q: "What does <code>id()</code> return?", a: "Memory address of the object (unique ID)." + createCodeWindow(`id("hello")`) },
                        { q: "What is <code>round()</code> used for?", a: "Rounds a number to a given number of decimal places." + createCodeWindow(`round(3.456, 2) → 3.46`) },
                        { q: "What’s the use of <code>input()</code> in functions?", a: "Takes user input as a string." + createCodeWindow(`input("Enter your name: ")`) }
                    ], 
                    "🎲 Math & Random Modules": [
                        { q: "How do you import the <code>math</code> module?", a: createCodeWindow(`import math`) },
                        { q: "What does <code>math.sqrt(x)</code> do?", a: "Returns the square root of x." + createCodeWindow(`math.sqrt(9) → 3.0`) },
                        { q: "How do you get the value of π (pi)?", a: `<code>math.pi</code>` },
                        { q: "What does <code>math.pow(a, b)</code> do?", a: "Raises a to the power of b." + createCodeWindow(`math.pow(2, 3) → 8.0`) },
                        { q: "How is <code>math.pow()</code> different from <code>**</code>?", a: "<code>math.pow()</code> always returns a float; <code>**</code> may return int." },
                        { q: "How to calculate factorial using <code>math</code>?", a: createCodeWindow(`math.factorial(5) → 120`) },
                        { q: "How to convert degrees to radians?", a: createCodeWindow(`math.radians(180) → π`) },
                        { q: "How to convert radians to degrees?", a: createCodeWindow(`math.degrees(math.pi) → 180.0`) },
                        { q: "What is <code>math.floor(x)</code>?", a: "Rounds x down to nearest integer." + createCodeWindow(`math.floor(3.7) → 3`) },
                        { q: "What is <code>math.ceil(x)</code>?", a: "Rounds x up to nearest integer." + createCodeWindow(`math.ceil(3.1) → 4`) },
                        { q: "How to compute absolute value using <code>math</code>?", a: "<code>math.fabs(x)</code> returns float absolute value." + createCodeWindow(`math.fabs(-5) → 5.0`) },
                        { q: "What is <code>math.gcd(a, b)</code> used for?", a: "Finds the greatest common divisor." + createCodeWindow(`math.gcd(8, 12) → 4`) },
                        { q: "How to compute logarithms?", a: "<code>math.log(x, base)</code>" + createCodeWindow(`math.log(8, 2) → 3.0`) },
                        { q: "What is <code>math.exp(x)</code>?", a: "Returns e^x." + createCodeWindow(`math.exp(1) ≈ 2.718`) },
                        { q: "How to get the remainder of a division?", a: "<code>math.remainder(x, y)</code> returns IEEE 754-style remainder." + createCodeWindow(`math.remainder(7, 2) → 1.0`) },
                        { q: "How do you import the <code>random</code> module?", a: createCodeWindow(`import random`) },
                        { q: "What does <code>random.random()</code> do?", a: "Returns a random float between 0.0 and 1.0 (inclusive of 0, exclusive of 1)." + createCodeWindow(`random.random() → 0.6743...`) },
                        { q: "How to get a random float between two values?", a: "Use <code>random.uniform(a, b)</code>" + createCodeWindow(`random.uniform(1.5, 3.5) → 2.73...`) },
                        { q: "How do you get a random integer in a range?", a: "Use <code>random.randint(a, b)</code> (both inclusive)" + createCodeWindow(`random.randint(1, 10) → 7`) },
                        { q: "What’s the difference between <code>randint()</code> and <code>randrange()</code>?", a: "<code>randint(a, b)</code> includes both ends, <code>randrange(start, stop)</code> excludes stop." + createCodeWindow(`random.randrange(1, 5) → 1, 2, 3 or 4`) },
                        { q: "How to select a random item from a list?", a: "Use <code>random.choice(seq)</code>" + createCodeWindow(`random.choice(['apple', 'banana']) → 'banana'`) },
                        { q: "How to select multiple random items?", a: "Use <code>random.choices(population, k=n)</code>" + createCodeWindow(`random.choices([1,2,3], k=2) → [2, 2] (with replacement)`) },
                        { q: "How to get a sample without replacement?", a: "Use <code>random.sample(population, k)</code>" + createCodeWindow(`random.sample([1,2,3,4], 2) → [1, 4] (unique values only)`) },
                        { q: "What does <code>random.shuffle()</code> do?", a: "Shuffles a list in-place." + createCodeWindow(`random.shuffle(my_list) # changes order permanently.`) },
                        { q: "How do you generate a random even number from 0 to 100?", a: createCodeWindow(`random.randrange(0, 101, 2)`) },
                        { q: "How can you make random outputs repeatable?", a: "Set a seed using <code>random.seed(n)</code>" + createCodeWindow(`random.seed(42) # makes random values reproducible.`) },
                        { q: "Can you generate cryptographic random numbers using <code>random</code>?", a: "No! Use <code>secrets</code> module for secure tokens/passwords." },
                        { q: "How to shuffle a copy of a list?", a: "Use <code>random.sample(lst, len(lst))</code> instead of <code>shuffle()</code>" },
                        { q: "What does setting a seed actually do?", a: "It initializes the internal state of the random generator for consistent results." },
                        { q: "How to simulate a coin toss using <code>random</code>?", a: createCodeWindow(`random.choice(['Heads', 'Tails'])`) }
                    ],
                    "🏛️ Classes & Objects": [ { q: "What is a class?", a: "A blueprint for creating objects." } ], 
                    "🛠️ Constructors": [ { q: "What is the <code>__init__</code> method?", a: "A constructor method that is called when an object is created." } ], 
                    "👨‍👩‍👧‍👦 Inheritance": [ { q: "What is inheritance?", a: "A way to form new classes using classes that have already been defined." } ], 
                    "🎭 Polymorphism": [ { q: "What is polymorphism?", a: "The ability of an object to take on many forms." } ], 
                    "💊 Encapsulation": [ { q: "What is encapsulation?", a: "Restricting access to methods and variables to prevent direct data modification." } ]
                },
                quiz: {
                    beginner: [
                        { q: "Which of these is a valid variable name?", options: ["1value", "value_1", "value-1"], correct: 1 },
                        { q: "What will <code>10 // 3</code> return?", options: ["3", "3.33", "1"], correct: 0 },
                        { q: "What is the result of <code>type(\"10\")</code>?", options: ["&lt;class 'int'&gt;", "&lt;class 'str'&gt;", "&lt;str&gt;"], correct: 1 },
                        { q: "Which keyword defines a function in Python?", options: ["func", "def", "function"], correct: 1 },
                        { q: "Which operator is used to calculate power (exponentiation)?", options: ["^", "**", "^^"], correct: 1 },
                        { q: "Which of these is used to create a comment?", options: ["//", "#", "--"], correct: 1 },
                        { q: "What is the output of <code>print(\"Hi\" * 3)</code>?", options: ["HiHiHi", "Hi3", "Error"], correct: 0 },
                        { q: "What does <code>len([1, 2, 3, 4])</code> return?", options: ["3", "4", "5"], correct: 1 },
                        { q: "Which loop runs until a condition becomes false?", options: ["for", "while", "loop"], correct: 1 },
                        { q: "What is the correct way to define a tuple?", options: ["[1, 2, 3]", "{1, 2, 3}", "(1, 2, 3)"], correct: 2 },
                        { q: "Which method removes the last item from a list?", options: ["pop()", "delete()", "remove()"], correct: 0 },
                        { q: "How do you check if a key \"name\" exists in a dictionary <code>d</code>?", options: ["name in d", "\"name\" in d", "d.has(\"name\")"], correct: 1 },
                        { q: "Which of the following is immutable?", options: ["List", "Dictionary", "Tuple"], correct: 2 },
                        { q: "Which data structure does not allow duplicate values?", options: ["List", "Set", "Dictionary"], correct: 1 },
                        { q: "What is the output of <code>bool(0)</code>?", options: ["True", "False", "None"], correct: 1 },
                        { q: "How would you convert a float to int?", options: ["int(float_num)", "float(int)", "str(int)"], correct: 0 },
                        { q: "What is the output of this code?" + createCodeWindow("x = 5\nif x == 5:\n    print(\"Yes\")"), options: ["Yes", "True", "5"], correct: 0 },
                        { q: "What is <code>range(3)</code> equal to when converted to a list?", options: ["[0, 1, 2]", "[1, 2, 3]", "[1, 2]"], correct: 0 },
                        { q: "Which function returns absolute value?", options: ["absolute()", "abs()", "fabs()"], correct: 1 },
                        { q: "How do you get user input?", options: ["scan()", "input()", "get()"], correct: 1 },
                        { q: "Which of the following will create a dictionary?", options: ["dict = [1, 2, 3]", "dict = {\"a\": 1, \"b\": 2}", "dict = (1, 2, 3)"], correct: 1 },
                        { q: "What does <code>\"python\".upper()</code> return?", options: ["\"PYTHON\"", "\"python\"", "\"Python\""], correct: 0 },
                        { q: "What will <code>print(3 == 3.0)</code> output?", options: ["False", "True", "Error"], correct: 1 },
                        { q: "Which symbol is used for modulus (remainder)?", options: ["%", "//", "&"], correct: 0 },
                        { q: "Which of these is a valid function call?", options: ["print[\"Hello\"]", "print(\"Hello\")", "print = \"Hello\""], correct: 1 }
                    ],
                    intermediate: [
                        { q: "What does the following code do?" + createCodeWindow('f = open("data.txt", "w")\nf.write("Hello")\nf.close()'), options: ["Prints Hello", "Writes Hello to data.txt", "Nothing happens"], correct: 1 },
                        { q: "What happens if the file doesn't exist in read mode?" + createCodeWindow('f = open("nofile.txt", "r")'), options: ["Creates a new file", "Raises FileNotFoundError", "Returns None"], correct: 1 },
                        { q: "What is the output?" + createCodeWindow('try:\n    x = 5 / 0\nexcept ZeroDivisionError:\n    print("Oops!")'), options: ["Oops!", "0", "Error"], correct: 0 },
                        { q: "What will be printed?" + createCodeWindow('def add(x, y):\n    return x + y\n\nprint(add(2, 3))'), options: ["2 + 3", "5", "None"], correct: 1 },
                        { q: "What’s the output?" + createCodeWindow('nums = [1, 2, 3, 4]\nsquares = [x**2 for x in nums]\nprint(squares)'), options: ["[2, 4, 6, 8]", "[1, 4, 9, 16]", "[1, 2, 3, 4]"], correct: 1 },
                        { q: "Which code snippet correctly handles a file safely?", options: ["<code>f = open(\"a.txt\")<br># no close</code>", createCodeWindow('with open("a.txt") as f:\n    data = f.read()'), "<code>open(\"a.txt\", \"close\")</code>"], correct: 1 },
                        { q: "What does this return?" + createCodeWindow('list(map(lambda x: x + 1, [1, 2, 3]))'), options: ["[2, 3, 4]", "[1, 2, 3]", "[0, 1, 2]"], correct: 0 },
                        { q: "Output of this?" + createCodeWindow('print((lambda x: x * x)(4))'), options: ["16", "8", "4"], correct: 0 },
                        { q: "What's printed?" + createCodeWindow('nums = [1, 2, 3, 4]\neven = list(filter(lambda x: x % 2 == 0, nums))\nprint(even)'), options: ["[2, 4]", "[1, 3]", "[1, 2, 3, 4]"], correct: 0 },
                        { q: "Output?" + createCodeWindow('import math\nprint(math.floor(3.9))'), options: ["4", "3", "3.9"], correct: 1 },
                        { q: "Output?" + createCodeWindow('import random\nrandom.seed(1)\nprint(random.randint(1, 10))'), options: ["Random value", "Always 2", "Error"], correct: 1 },
                        { q: "What does this code print?" + createCodeWindow('x = 10\ndef change():\n    x = 20\n    print(x)\n\nchange()\nprint(x)'), options: ["20 10", "10 20", "20 20"], correct: 0 },
                        { q: "What’s printed?" + createCodeWindow('global_var = 5\ndef show():\n    global global_var\n    global_var += 1\n\nshow()\nprint(global_var)'), options: ["5", "6", "Error"], correct: 1 },
                        { q: "What is returned?" + createCodeWindow('def f():\n    local_var = 10\n    return local_var\n\nprint(f())'), options: ["None", "10", "local_var"], correct: 1 },
                        { q: "Output of this?" + createCodeWindow('nums = [1, 2, 3]\ndoubled = [x*2 for x in nums if x > 1]\nprint(doubled)'), options: ["[2, 4, 6]", "[4, 6]", "[1, 2, 3]"], correct: 1 },
                        { q: "What is the result?" + createCodeWindow('list1 = [1, 2]\nlist2 = [3, 4]\nprint(list1 + list2)'), options: ["[1, 2, 3, 4]", "[4, 6]", "[[1,2],[3,4]]"], correct: 0 },
                        { q: "What’s the output?" + createCodeWindow('def demo(x, *args):\n    return args\n\nprint(demo(1, 2, 3))'), options: ["(2, 3)", "[2, 3]", "2 3"], correct: 0 },
                        { q: "What’s printed?" + createCodeWindow('def power(x, y=2):\n    return x ** y\n\nprint(power(3))'), options: ["6", "9", "3"], correct: 1 },
                        { q: "What is the result of this?" + createCodeWindow('print(len("Hello World!"))'), options: ["11", "12", "10"], correct: 1 },
                        { q: "Output?" + createCodeWindow('print("Hello".replace("H", "J"))'), options: ["Jello", "Hello", "Hjello"], correct: 0 },
                        { q: "Result of this?" + createCodeWindow('round(3.456, 2)'), options: ["3.45", "3.46", "3.44"], correct: 1 },
                        { q: "What does this return?" + createCodeWindow('"abc".upper()'), options: ["abc", "ABC", "Abc"], correct: 1 },
                        { q: "What does <code>reduce()</code> require?", options: ["2 arguments", "A function + iterable", "Just an iterable"], correct: 1 },
                        { q: "What does this print?" + createCodeWindow('import math\nprint(math.pow(2, 3))'), options: ["8.0", "8", "6"], correct: 0 },
                        { q: "Output?" + createCodeWindow('print(type((1)))'), options: ["&lt;class 'tuple'&gt;", "&lt;class 'int'&gt;", "&lt;class 'list'&gt;"], correct: 1 }
                    ],
                    oop: [
                        { q: "What does <code>self</code> refer to in a class method?" + createCodeWindow('class Dog:\n    def bark(self):\n        print("Woof!")'), options: ["The class itself", "The current instance", "A local variable"], correct: 1 },
                        { q: "What will the following code print?" + createCodeWindow('class A:\n    def greet(self):\n        print("Hello from A")\n\nclass B(A):\n    pass\n\nobj = B()\nobj.greet()'), options: ["Hello from B", "Error", "Hello from A"], correct: 2 },
                        { q: "Which method is used to initialize an object in Python?", options: ["__start__()", "__create__()", "__init__()"], correct: 2 },
                        { q: "What will this output?" + createCodeWindow('class Person:\n    def __init__(self, name):\n        self.name = name\n\np = Person("Alice")\nprint(p.name)'), options: ["Person", "name", "Alice"], correct: 2 },
                        { q: "Which of the following indicates inheritance in Python?", options: ["class A inherits B:", "class A(B):", "class A -> B:"], correct: 1 },
                        { q: "Which of the following is NOT a pillar of OOP?", options: ["Inheritance", "Encapsulation", "Compilation"], correct: 2 },
                        { q: "How can you prevent access to a class variable directly?" + createCodeWindow('class Secret:\n    def __init__(self):\n        self.__code = "1234"'), options: ["Use a single underscore", "Use double underscore", "Make it capitalized"], correct: 1 },
                        { q: "Which method converts an object to a string?", options: ["__str__()", "__repr__()", "__toString__()"], correct: 0 },
                        { q: "What will this print?" + createCodeWindow('class A:\n    def show(self):\n        print("A")\n\nclass B(A):\n    def show(self):\n        print("B")\n\nB().show()'), options: ["A", "B", "Error"], correct: 1 },
                        { q: "What is polymorphism in Python?", options: ["Using many classes", "Functions/classes with multiple forms", "Having many objects"], correct: 1 },
                        { q: "Which method is used to destroy objects?", options: ["__del__()", "__delete__()", "__destroy__()"], correct: 0 },
                        { q: "What does this print?" + createCodeWindow('class Test:\n    def __init__(self):\n        print("Created!")\n\nt1 = Test()\nt2 = Test()'), options: ["Created!", "Created! Created!", "Nothing"], correct: 1 },
                        { q: "What does encapsulation mean?", options: ["Inheriting multiple classes", "Hiding internal state", "Making a class global"], correct: 1 },
                        { q: "Which keyword is used to inherit a class?", options: ["inherits", "derive", "class B(A)"], correct: 2 },
                        { q: "What’s wrong here?" + createCodeWindow('class MyClass:\n    def __init__():\n        self.name = "Oops"'), options: ["Missing self in parameter", "self cannot be used", "__init__ shouldn't be used"], correct: 0 },
                        { q: "Output of the following?" + createCodeWindow('class A:\n    pass\n\na1 = A()\nprint(isinstance(a1, A))'), options: ["True", "False", "Error"], correct: 0 },
                        { q: "What will this return?" + createCodeWindow('class Base:\n    def talk(self):\n        return "Talking"\n\nclass Child(Base):\n    pass\n\nprint(Child().talk())'), options: ["Nothing", "Error", "Talking"], correct: 2 },
                        { q: "Choose the correct one for method overloading in Python.", options: ["Supported natively", "Can use default arguments", "Must define many functions"], correct: 1 },
                        { q: "How to define a class attribute?" + createCodeWindow('class Sample:\n    counter = 0'), options: ["Inside __init__()", "Inside method only", "Outside methods in class"], correct: 2 },
                        { q: "Static methods in Python use:", options: ["@staticmethod", "@class", "@selfmethod"], correct: 0 },
                        { q: "What’s the output?" + createCodeWindow('class A:\n    def __str__(self):\n        return "A"\n\nprint(A())'), options: ["Memory address", "A", "Error"], correct: 1 },
                        { q: "How to define a class method?", options: ["@staticmethod", "@classmethod", "@method"], correct: 1 },
                        { q: "What is multiple inheritance?", options: ["Class with many objects", "Class inheriting from many classes", "Class having many methods"], correct: 1 },
                        { q: "What will this code print?" + createCodeWindow('class A:\n    def f(self):\n        print("A")\n\nclass B:\n    def f(self):\n        print("B")\n\nclass C(A, B):\n    pass\n\nC().f()'), options: ["A", "B", "Error"], correct: 0 },
                        { q: "Which will define an object?" + createCodeWindow('class A:\n    pass\n\nx = A()'), options: ["A()", "class A:", "pass"], correct: 0 }
                    ],
                    marathon: [
                        { q: "What will be the output of this code?" + createCodeWindow('x = "10"\ny = int(x)\nprint(y + 5)'), options: ["105", "15", "Error"], correct: 1 },
                        { q: "What does this return? <code>type([1, 2, 3])</code>", options: ["&lt;class 'list'&gt;", "&lt;type 'array'&gt;", "&lt;class 'tuple'&gt;"], correct: 0 },
                        { q: "What is the output of this loop?" + createCodeWindow('for i in range(2, 7, 2):\n    print(i, end=" ")'), options: ["2 4 6", "2 3 4 5 6", "2 4 6 8"], correct: 0 },
                        { q: "Which keyword is used for defining a function in Python?", options: ["def", "function", "func"], correct: 0 },
                        { q: "What will be the result?" + createCodeWindow('name = "Python"\nprint(name[::-1])'), options: ["Python", "nohtyP", "Error"], correct: 1 },
                        { q: "What’s the output?" + createCodeWindow('mylist = [1, 2, 3]\nmylist.append([4, 5])\nprint(mylist)'), options: ["[1, 2, 3, 4, 5]", "[1, 2, 3, [4, 5]]", "Error"], correct: 1 },
                        { q: "What does this return? <code>bool(\"\") == False</code>", options: ["True", "False", "Error"], correct: 0 },
                        { q: "What happens here? <code>print(10 / 3)</code>", options: ["3", "3.333...", "3.0"], correct: 1 },
                        { q: "What does <code>strip()</code> do?", options: ["Removes specific characters", "Removes whitespace from ends", "Changes case"], correct: 1 },
                        { q: "Output of this comprehension? <code>[i*i for i in range(3)]</code>", options: ["[1, 2, 3]", "[0, 1, 4]", "[0, 1, 2]"], correct: 1 },
                        { q: "What’s printed here?" + createCodeWindow('print(list(map(lambda x: x + 2, [1, 2, 3])))'), options: ["[3, 4, 5]", "[1, 2, 3]", "[2, 3, 4]"], correct: 0 },
                        { q: "Output of this?" + createCodeWindow('try:\n    print(1 / 0)\nexcept ZeroDivisionError:\n    print("Can\'t divide by zero!")'), options: ["0", "Error", "Can't divide by zero!"], correct: 2 },
                        { q: "Which module gives access to random choices?", options: ["math", "random", "numpy"], correct: 1 },
                        { q: "What is the output?" + createCodeWindow('x = 5\ndef change():\n    global x\n    x = 10\nchange()\nprint(x)'), options: ["5", "10", "Error"], correct: 1 },
                        { q: "What does this code do?" + createCodeWindow('import math\nprint(math.floor(2.9))'), options: ["3", "2", "Error"], correct: 1 },
                        { q: "Which of these defines a class?", options: ["class MyClass():", "MyClass = class()", "def MyClass():"], correct: 0 },
                        { q: "What does this return?" + createCodeWindow('class Dog:\n    def __init__(self):\n        self.sound = "bark"\n        \nd = Dog()\nprint(d.sound)'), options: ["bark", "Error", "None"], correct: 0 },
                        { q: "Output of this?" + createCodeWindow('class A:\n    def hello(self):\n        return "Hi"\n        \na = A()\nprint(a.hello())'), options: ["Hi", "hello", "Error"], correct: 0 },
                        { q: "Which method is called automatically when object is created?", options: ["__new__()", "__init__()", "__str__()"], correct: 1 },
                        { q: "What is Inheritance used for?", options: ["Encapsulation", "Code reusability", "Debugging"], correct: 1 }
                    ]
                }
            },
            javascript: {
                flashcards: {
                    "General": [ { q: "What is a 'closure'?", a: "A function that remembers the variables from the scope where it was created." }, { q: "Explain <code>==</code> vs <code>===</code>.", a: "<code>==</code> is for loose equality (type coercion). <code>===</code> is for strict equality (value and type)." }, { q: "What is a Promise?", a: "An object representing the eventual completion or failure of an async operation."} ]
                }
            }
        };

        const cheatSheets = {
            python: `
                <div class="cheatsheet-content">
                    <h2 class="text-3xl font-bold text-center mb-6 text-cyan-400">🐍 Python Cheatsheet for Revision 📘</h2>
                    
                    <h3>🔤 1. Variables & Data Types</h3>
                    <p>Variables are like containers. You store stuff in them 🧃</p>
                    ${createCodeWindow(`name = "Dibyansh"     # str (text)
age = 20              # int (whole number)
height = 5.9          # float (decimal)
is_coder = True       # bool (True/False)`)}
                    <p>Want to know the type? Use <code>type()</code> 👇</p>
                    ${createCodeWindow(`print(type(name))  # <class 'str'>`)}

                    <h3>🔁 2. Loops</h3>
                    <p>🌀 <strong>for loop</strong> – when you know how many times</p>
                    ${createCodeWindow(`for i in range(1, 6):
    print("Hi", i)`)}
                    <p>🔁 <strong>while loop</strong> – when you loop until a condition is false</p>
                    ${createCodeWindow(`count = 0
while count < 3:
    print("Looping...", count)
    count += 1`)}
                    <p>⛔ Don’t forget to change your condition or it loops forever 😨</p>

                    <h3>🔎 3. If-Else Conditions</h3>
                    <p>Making decisions like a boss 🧠</p>
                    ${createCodeWindow(`temp = 35

if temp > 30:
    print("It's hot 🥵")
elif temp == 30:
    print("Just right 🌤️")
else:
    print("Cool 😎")`)}

                    <h3>🧺 4. Lists – Ordered, changeable, and allows duplicates</h3>
                    ${createCodeWindow(`fruits = ["🍎", "🍌", "🍇"]
print(fruits[0])         # 🍎
fruits.append("🍍")      # Add to end
fruits.remove("🍌")      # Remove item
print(len(fruits))       # Count items`)}
                    <p>🛠 Handy tools: <code>fruits.sort()</code>, <code>fruits.reverse()</code></p>

                    <h3>📚 5. Tuples & Sets</h3>
                    <p>✅ <strong>Tuple</strong> – like a list, but can't change it (immutable)</p>
                    ${createCodeWindow(`t = (1, 2, 3)
print(t[0])`)}
                    <p>🚫 <strong>Set</strong> – only unique values, no duplicates allowed</p>
                    ${createCodeWindow(`s = {1, 2, 3, 2}
print(s)  # {1, 2, 3}`)}

                    <h3>📖 6. Dictionaries – key-value pairs 🔐</h3>
                    ${createCodeWindow(`person = {
    "name": "Ommi",
    "age": 20
}

print(person["name"])   # Ommi
person["city"] = "Bhubaneswar"`)}
                    <p>🧠 <code>dict.keys()</code>, <code>dict.values()</code>, <code>dict.items()</code> are useful!</p>

                    <h3>⚙️ 7. Functions</h3>
                    <p>Reusable code blocks 📦</p>
                    ${createCodeWindow(`def greet(name):
    return "Hi " + name

print(greet("Dibs"))  # Hi Dibs`)}
                    <p>Use <code>return</code> to give back a value, otherwise it just prints.</p>

                    <h3>🧠 8. Built-in Functions You Should Know</h3>
                    <table>
                        <thead><tr><th>Function</th><th>What it does</th></tr></thead>
                        <tbody>
                            <tr><td><code>len(x)</code></td><td>Count length</td></tr>
                            <tr><td><code>type(x)</code></td><td>Check type</td></tr>
                            <tr><td><code>abs(x)</code></td><td>Absolute value</td></tr>
                            <tr><td><code>sum(x)</code></td><td>Add items in an iterable</td></tr>
                            <tr><td><code>round(x)</code></td><td>Round floats</td></tr>
                            <tr><td><code>sorted(x)</code></td><td>Return sorted list</td></tr>
                        </tbody>
                    </table>
                    <p>Example:</p>
                    ${createCodeWindow(`nums = [5, 3, 9]
print(sorted(nums))  # [3, 5, 9]`)}

                    <h3>📦 9. Modules (import stuff!)</h3>
                    <p>🔢 <strong>math</strong> module</p>
                    ${createCodeWindow(`import math
print(math.sqrt(25))     # 5.0
print(math.pi)           # 3.14159...`)}
                    <p>🎲 <strong>random</strong> module</p>
                    ${createCodeWindow(`import random
print(random.randint(1, 10))`)}

                    <h3>� 10. File Handling</h3>
                    <p>📝 Create/write a file:</p>
                    ${createCodeWindow(`with open("hello.txt", "w") as f:
    f.write("Hello World!")`)}
                    <p>📖 Read from a file:</p>
                    ${createCodeWindow(`with open("hello.txt", "r") as f:
    content = f.read()
    print(content)`)}

                    <h3>🚫 11. Exception Handling – Catching Errors!</h3>
                    ${createCodeWindow(`try:
    result = 10 / 0
except ZeroDivisionError:
    print("Can't divide by 0!")
finally:
    print("This runs anyway.")`)}
                    <p>✅ Common errors: <code>ZeroDivisionError</code>, <code>ValueError</code>, <code>TypeError</code>, <code>IndexError</code></p>

                    <h3>🔥 12. List Comprehension</h3>
                    <p>Shortcuts for creating lists</p>
                    ${createCodeWindow(`squares = [x*x for x in range(1, 6)]
print(squares)  # [1, 4, 9, 16, 25]`)}
                     <p>Add an <code>if</code>:</p>
                    ${createCodeWindow(`even = [x for x in range(10) if x % 2 == 0]`)}

                    <h3>⚡ 13. Lambda Functions</h3>
                    <p>One-liner anonymous functions</p>
                    ${createCodeWindow(`add = lambda a, b: a + b
print(add(2, 3))  # 5`)}
                    <p>💡 Great for quick functions or with <code>map()</code> & <code>filter()</code></p>

                    <h3>🎁 14. *args and **kwargs</h3>
                     <p>Flexible Function Parameters</p>
                    ${createCodeWindow(`def show_args(*args):
    print(args)

def show_kwargs(**kwargs):
    print(kwargs)

show_args(1, 2, 3)  # (1, 2, 3)
show_kwargs(name="Dibs", age=20)
# {'name': 'Dibs', 'age': 20}`)}

                    <h3>🧱 15. Object-Oriented Programming (Classes)</h3>
                    ${createCodeWindow(`class Student:
    def __init__(self, name):
        self.name = name

    def greet(self):
        print("Hi, I'm", self.name)

s = Student("Ommi")
s.greet()`)}
                    <p>🧠 <code>__init__()</code> is like a constructor. 💡 <code>self</code> refers to the current object.</p>
                </div>
            `
        };


        const topicStructure = {
            python: {
                "🟢 Beginner-Level": ["📦 Python Basics", "🔢 Variables & Data Types", "➕ Operators", "🔀 Control Flow (if-elif-else)", "🔄 Loops (for, while)", "ƒ Functions", "📋 Lists", "🔗 Tuples", "📚 Dictionaries", "✨ Sets", "✂️ String Manipulation", "🔄 Type Casting", "⌨️ Input/Output"],
                "🟡 Intermediate-Level": ["📁 File Handling", "⚠️ Error Handling (Exceptions)", "📦 Modules & Packages", "λ Lambda, Map, Filter, Reduce", "⚡ List Comprehensions", "🌐 Scope (Global/Local)", "🔧 Built-in Functions", "🎲 Math & Random Modules"],
                "🔵 Object-Oriented Programming": ["🏛️ Classes & Objects", "🛠️ Constructors", "👨‍👩‍👧‍👦 Inheritance", "🎭 Polymorphism", "💊 Encapsulation"]
            }
        };
        
        // --- DOM Elements ---
        const pages = document.querySelectorAll('.page');
        const startBtn = document.getElementById('start-btn');
        const languageCards = document.querySelectorAll('.language-card');
        const selectedLangModeSpan = document.getElementById('selected-lang-mode-span');
        const modeCards = document.querySelectorAll('.mode-card');
        const deckList = document.getElementById('deck-list');
        const backBtns = document.querySelectorAll('.back-btn');
        const flashcardInner = document.getElementById('flashcard-inner');
        const cardFrontText = document.getElementById('card-front-text');
        const cardBackText = document.getElementById('card-back-text');
        const cardBackContent = document.getElementById('card-back-content');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const nextDeckBtn = document.getElementById('next-deck-btn');
        const progressIndicator = document.getElementById('progress-indicator');
        const bookmarkBtn = document.getElementById('bookmark-btn');
        const viewBookmarksBtn = document.getElementById('view-bookmarks-btn');
        const bookmarksList = document.getElementById('bookmarks-list');
        const bookmarksLangSpan = document.getElementById('bookmarks-lang-span');
        const cheatsheetContentWrapper = document.getElementById('cheatsheet-content-wrapper');
        const quizDeckBtns = document.querySelectorAll('.quiz-deck-btn');
        const quizScoreEl = document.getElementById('quiz-score');
        const quizTimerEl = document.getElementById('quiz-timer');
        const quizQuestionNumEl = document.getElementById('quiz-question-number');
        const quizTotalQuestionsEl = document.getElementById('quiz-total-questions');
        const quizQuestionTextEl = document.getElementById('quiz-question-text');
        const quizOptionsContainer = document.getElementById('quiz-options-container');
        const quizFeedbackEl = document.getElementById('quiz-feedback');
        const finalScoreTextEl = document.getElementById('final-score-text');
        const speedometerNeedle = document.getElementById('speedometer-needle');
        const finalMessageEl = document.getElementById('final-message');
        const finalTimeTakenEl = document.getElementById('final-time-taken');
        const tryAgainBtn = document.getElementById('try-again-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const endQuizBtn = document.getElementById('end-quiz-btn');
        const instrTotalQuestions = document.getElementById('instr-total-questions');
        const instrTotalPoints = document.getElementById('instr-total-points');
        const instrPassingScore = document.getElementById('instr-passing-score');
        const avgQuizScoreEl = document.getElementById('avg-quiz-score');
        const cardsReviewedEl = document.getElementById('cards-reviewed');
        const topicMasteryContainer = document.getElementById('topic-mastery-container');
        const createDeckNavBtn = document.getElementById('create-deck-nav-btn');
        const addCardBtn = document.getElementById('add-card-btn');
        const saveDeckBtn = document.getElementById('save-deck-btn');
        const customCardsContainer = document.getElementById('custom-cards-container');
        const topicSearchInput = document.getElementById('topic-search-input');
        
        // --- STATE ---
        let selectedLanguage = '';
        let selectedLanguageName = '';
        let selectedMode = '';
        let selectedDeck = '';
        let currentCardIndex = 0;
        let isFlipped = false;
        let learningChart = null;
        
        // Quiz State
        let quizScore = 0;
        let quizTimerInterval;
        let quizQuestions = [];
        let currentQuizQuestionIndex = 0;
        let quizStartTime;
        let selectedQuizDeckName = '';
        let totalPossibleScore = 0;
        let passingScore = 0;
        const QUIZ_TIME_LIMIT = 20 * 60; // 20 minutes in seconds


        // --- DATA PERSISTENCE FUNCTIONS ---
        function getProgress() {
            return JSON.parse(localStorage.getItem('revvup_progress')) || {};
        }

        function saveProgress(lang, mode, deck, index) {
            const progress = getProgress();
            if (!progress[lang]) progress[lang] = {};
            if (!progress[lang][mode]) progress[lang][mode] = {};
            
            const currentHighest = progress[lang][mode][deck] || -1;
            progress[lang][mode][deck] = Math.max(currentHighest, index);
            
            localStorage.setItem('revvup_progress', JSON.stringify(progress));
        }

        function getBookmarks() {
            return JSON.parse(localStorage.getItem('revvup_bookmarks')) || {};
        }

        function saveBookmarks(bookmarksObj) {
            localStorage.setItem('revvup_bookmarks', JSON.stringify(bookmarksObj));
        }
        
        function getQuizHistory() {
            return JSON.parse(localStorage.getItem('revvup_quiz_history')) || {};
        }

        function saveQuizHistory(historyObj) {
             localStorage.setItem('revvup_quiz_history', JSON.stringify(historyObj));
        }
        
        function getCustomDecks() {
            return JSON.parse(localStorage.getItem('revvup_custom_decks')) || {};
        }

        function saveCustomDecks(decksObj) {
            localStorage.setItem('revvup_custom_decks', JSON.stringify(decksObj));
        }

        // --- UI FUNCTIONS ---

        function showPage(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function getOrderedDeckNames() {
            const structure = topicStructure[selectedLanguage];
            const customDecks = getCustomDecks()[selectedLanguage] || {};
            let orderedDecks = [];

            for (const category in structure) {
                structure[category].forEach(topicName => {
                    if (allData[selectedLanguage].flashcards[topicName]?.length > 0) {
                        orderedDecks.push(topicName);
                    }
                });
            }
            orderedDecks = [...orderedDecks, ...Object.keys(customDecks)];
            return orderedDecks;
        }

        function populateTopics(lang) {
            const structure = topicStructure[lang];
            const customDecks = getCustomDecks()[lang] || {};
            deckList.innerHTML = ''; 
            const progress = getProgress();

            // Built-in Decks
            for (const category in structure) {
                const categoryContainer = document.createElement('div');
                categoryContainer.className = 'deck-category-container';
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'text-2xl font-bold text-cyan-400 mb-4';
                categoryTitle.textContent = category;
                categoryContainer.appendChild(categoryTitle);
                
                const topicGrid = document.createElement('div');
                topicGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                structure[category].forEach(topicName => {
                    const totalCards = allData[lang].flashcards[topicName]?.length || 0;
                    const highestIndexReached = progress[lang]?.flashcards?.[topicName] ?? -1;
                    if(totalCards > 0) {
                        topicGrid.appendChild(createTopicCard(topicName, highestIndexReached, totalCards));
                    }
                });
                
                categoryContainer.appendChild(topicGrid);
                deckList.appendChild(categoryContainer);
            }
            
            // Custom Decks
            if (Object.keys(customDecks).length > 0) {
                const categoryContainer = document.createElement('div');
                categoryContainer.className = 'deck-category-container';
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'text-2xl font-bold text-amber-400 mt-8 mb-4';
                categoryTitle.textContent = 'My Decks';
                categoryContainer.appendChild(categoryTitle);

                const topicGrid = document.createElement('div');
                topicGrid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                for (const deckName in customDecks) {
                    const totalCards = customDecks[deckName].length;
                    const highestIndexReached = progress[lang]?.flashcards?.[deckName] ?? -1;
                    topicGrid.appendChild(createTopicCard(deckName, highestIndexReached, totalCards, true));
                }
                categoryContainer.appendChild(topicGrid);
                deckList.appendChild(categoryContainer);
            }

            addTopicCardListeners();
        }
        
        function createTopicCard(topicName, highestIndexReached, totalCards, isCustom = false) {
            const topicCard = document.createElement('div');
            const borderColor = isCustom ? 'hover:border-amber-400' : 'hover:border-cyan-400';
            topicCard.className = `deck-card bg-gray-800 p-4 rounded-lg border border-gray-700 ${borderColor} cursor-pointer transition-all duration-200 shadow-lg text-left flex flex-col justify-between`;
            topicCard.dataset.deck = topicName;
            
            const completedCount = highestIndexReached + 1;
            const percentage = totalCards > 0 ? (completedCount / totalCards) * 100 : 0;

            topicCard.innerHTML = `
                <div>
                    <h4 class="font-semibold">${topicName}</h4>
                </div>
                <div class="mt-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500 font-tech">PROGRESS</span>
                        <span class="text-xs text-gray-400 font-tech">${completedCount > totalCards ? totalCards : completedCount}/${totalCards}</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-1.5 mt-1">
                        <div class="bg-cyan-500 h-1.5 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `;
            return topicCard;
        }

        function loadAndShowFeaturePage() {
            if (selectedMode === 'flashcards') {
                populateTopics(selectedLanguage);
                showPage('deck-select-page');
            } else if (selectedMode === 'cheatsheet') {
                cheatsheetContentWrapper.innerHTML = cheatSheets[selectedLanguage] || '<p class="text-center text-gray-500">Cheat sheet for this language is coming soon!</p>';
                showPage('cheatsheet-page');
            } else if (selectedMode === 'quiz') {
                showPage('quiz-deck-select-page');
            } else if (selectedMode === 'analytics') {
                showAnalyticsPage();
            }
        }

        function getFullDeckData() {
            const builtInDecks = allData[selectedLanguage].flashcards || {};
            const customDecks = getCustomDecks()[selectedLanguage] || {};
            return { ...builtInDecks, ...customDecks };
        }

        function loadFlashcards() {
            if (isFlipped) {
                isFlipped = false;
                flashcardInner.classList.remove('is-flipped');
            }
            setTimeout(() => {
                const progress = getProgress();
                const allDecks = getFullDeckData();
                const totalCards = allDecks[selectedDeck]?.length || 0;
                currentCardIndex = progress[selectedLanguage]?.flashcards?.[selectedDeck] ?? 0;
                
                if (currentCardIndex >= totalCards) currentCardIndex = 0;
                displayCard();
            }, 150);
        }

        function displayCard() {
            const allDecks = getFullDeckData();
            const cards = allDecks[selectedDeck];

            if (!cards || cards.length === 0) {
                 cardFrontText.innerHTML = "Coming Soon!";
                 cardBackText.innerHTML = "This topic deck is under construction.";
                 progressIndicator.textContent = '0 / 0';
                 bookmarkBtn.style.display = 'none';
                 return;
            };
            bookmarkBtn.style.display = 'block';
            const card = cards[currentCardIndex];
            cardFrontText.innerHTML = card.q;
            
            cardBackText.innerHTML = `<div class="answer-content">${card.a}</div>`;
            
            updateProgress();
            saveProgress(selectedLanguage, 'flashcards', selectedDeck, currentCardIndex);
            updateBookmarkButtonState();
            updateNavButtons();
        }
        
        function updateNavButtons() {
            const allDecks = getFullDeckData();
            const cards = allDecks[selectedDeck];
            const isLastCard = currentCardIndex === cards.length - 1;

            if (isLastCard) {
                const orderedDecks = getOrderedDeckNames();
                const currentDeckIndex = orderedDecks.indexOf(selectedDeck);
                if (currentDeckIndex < orderedDecks.length - 1) {
                    nextBtn.style.display = 'none';
                    nextDeckBtn.style.display = 'block';
                } else {
                    nextBtn.style.display = 'block';
                    nextDeckBtn.style.display = 'none';
                }
            } else {
                nextBtn.style.display = 'block';
                nextDeckBtn.style.display = 'none';
            }
        }

        function updateProgress() {
            const allDecks = getFullDeckData();
            const totalCards = allDecks[selectedDeck].length;
            progressIndicator.textContent = `${currentCardIndex + 1} / ${totalCards}`;
        }

        function nextCard() {
            const allDecks = getFullDeckData();
            const cards = allDecks[selectedDeck];
            if (currentCardIndex < cards.length - 1) {
                currentCardIndex++;
                if (isFlipped) {
                    isFlipped = false;
                    flashcardInner.classList.remove('is-flipped');
                }
                setTimeout(displayCard, 150);
            }
        }

        function prevCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                 if (isFlipped) {
                    isFlipped = false;
                    flashcardInner.classList.remove('is-flipped');
                }
                setTimeout(displayCard, 150);
            }
        }

        function goToNextDeck() {
            const orderedDecks = getOrderedDeckNames();
            const currentDeckIndex = orderedDecks.indexOf(selectedDeck);
            if (currentDeckIndex < orderedDecks.length - 1) {
                selectedDeck = orderedDecks[currentDeckIndex + 1];
                loadFlashcards();
            }
        }

        function toggleBookmark() {
            const allDecks = getFullDeckData();
            const cards = allDecks[selectedDeck];
            const card = cards[currentCardIndex];
            const bookmarkKey = `${selectedLanguage}-${selectedDeck}-${card.q}`;
            
            const bookmarks = getBookmarks();
            if (bookmarks[bookmarkKey]) {
                delete bookmarks[bookmarkKey];
            } else {
                bookmarks[bookmarkKey] = {
                    lang: selectedLanguage,
                    mode: 'flashcards',
                    deck: selectedDeck,
                    q: card.q,
                    a: card.a
                };
            }
            saveBookmarks(bookmarks);
            updateBookmarkButtonState();
        }

        function updateBookmarkButtonState() {
            const allDecks = getFullDeckData();
            const cards = allDecks[selectedDeck];
            if (!cards || cards.length === 0) return;
            const card = cards[currentCardIndex];
            const bookmarkKey = `${selectedLanguage}-${selectedDeck}-${card.q}`;
            const bookmarks = getBookmarks();
            
            if (bookmarks[bookmarkKey]) {
                bookmarkBtn.classList.add('bookmarked');
            } else {
                bookmarkBtn.classList.remove('bookmarked');
            }
        }

        function displayBookmarksPage() {
            bookmarksList.innerHTML = '';
            bookmarksLangSpan.textContent = selectedLanguageName;
            
            const bookmarks = getBookmarks();
            const langBookmarkKeys = Object.keys(bookmarks).filter(key => key.startsWith(`${selectedLanguage}-`));

            if (langBookmarkKeys.length === 0) {
                bookmarksList.innerHTML = `<p class="text-center text-gray-500">You haven't bookmarked any cards for this language yet.</p>`;
            } else {
                langBookmarkKeys.forEach(key => {
                    const cardData = bookmarks[key];
                    
                    if (cardData) {
                        const cardEl = document.createElement('div');
                        cardEl.className = 'bg-gray-800 p-4 rounded-lg border border-gray-700';
                        cardEl.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <p class="text-xs text-amber-400 font-tech">${cardData.deck}</p>
                                    <p class="font-semibold mt-1">${cardData.q}</p>
                                    <div class="mt-2 text-gray-400 text-sm">${cardData.a}</div>
                                </div>
                                <button class="remove-bookmark-btn p-1 text-gray-500 hover:text-red-500" data-bookmark-key="${key}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        `;
                        bookmarksList.appendChild(cardEl);
                    }
                });

                document.querySelectorAll('.remove-bookmark-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const keyToRemove = e.currentTarget.dataset.bookmarkKey;
                        const currentBookmarks = getBookmarks();
                        delete currentBookmarks[keyToRemove];
                        saveBookmarks(currentBookmarks);
                        displayBookmarksPage();
                    });
                });
            }
            
            showPage('bookmarks-page');
        }

        // --- QUIZ FUNCTIONS ---
        function showQuizInstructions(deckName) {
            selectedQuizDeckName = deckName;
            const questionsForDeck = allData[selectedLanguage].quiz[deckName] || [];
            if (questionsForDeck.length === 0) {
                alert("This quiz is not available yet.");
                return;
            }
            
            totalPossibleScore = questionsForDeck.length * 10;
            passingScore = Math.ceil(totalPossibleScore * 0.7);

            instrTotalQuestions.textContent = questionsForDeck.length;
            instrTotalPoints.textContent = totalPossibleScore;
            instrPassingScore.textContent = passingScore;

            showPage('quiz-instructions-page');
        }

        function startQuiz() {
            const allQuizQuestions = allData[selectedLanguage].quiz[selectedQuizDeckName] || [];
            
            quizQuestions = [...allQuizQuestions].sort(() => Math.random() - 0.5);
            
            currentQuizQuestionIndex = 0;
            quizScore = 0;
            
            quizScoreEl.textContent = quizScore;
            quizTotalQuestionsEl.textContent = quizQuestions.length;

            displayQuizQuestion();
            startQuizTimer();
            showPage('live-quiz-page');
        }

        function displayQuizQuestion() {
            quizFeedbackEl.textContent = '';
            const question = quizQuestions[currentQuizQuestionIndex];
            
            quizQuestionNumEl.textContent = currentQuizQuestionIndex + 1;
            quizQuestionTextEl.innerHTML = question.q;
            
            quizOptionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full text-left bg-gray-700 hover:bg-gray-600 p-4 rounded-lg transition-colors duration-200 font-tech';
                button.innerHTML = option;
                button.dataset.index = index;
                button.addEventListener('click', handleOptionClick);
                quizOptionsContainer.appendChild(button);
            });
        }

        function handleOptionClick(event) {
            const selectedButton = event.currentTarget;
            const selectedIndex = parseInt(selectedButton.dataset.index);
            const correctIndex = quizQuestions[currentQuizQuestionIndex].correct;

            const optionButtons = quizOptionsContainer.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => btn.disabled = true);

            if (selectedIndex === correctIndex) {
                quizScore += 10;
                selectedButton.classList.add('correct');
                quizFeedbackEl.textContent = "Correct! +10 Points 🎉";
                quizFeedbackEl.className = 'text-center mt-4 h-6 text-green-400 font-semibold';
            } else {
                quizScore -= 3;
                if (quizScore < 0) quizScore = 0;
                selectedButton.classList.add('incorrect');
                optionButtons[correctIndex].classList.add('correct');
                quizFeedbackEl.textContent = "Incorrect! -3 Points";
                quizFeedbackEl.className = 'text-center mt-4 h-6 text-red-400 font-semibold';
            }
            quizScoreEl.textContent = quizScore;

            setTimeout(() => {
                currentQuizQuestionIndex++;
                if (currentQuizQuestionIndex < quizQuestions.length) {
                    displayQuizQuestion();
                } else {
                    endQuiz();
                }
            }, 1500);
        }
        
        function startQuizTimer() {
            quizStartTime = new Date();
            let timeLeft = QUIZ_TIME_LIMIT;
            clearInterval(quizTimerInterval);
            
            quizTimerEl.textContent = formatTime(timeLeft);

            quizTimerInterval = setInterval(() => {
                timeLeft--;
                quizTimerEl.textContent = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    endQuiz();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function endQuiz() {
            clearInterval(quizTimerInterval);
            const quizEndTime = new Date();
            const timeTakenInSeconds = quizStartTime ? Math.floor((quizEndTime - quizStartTime) / 1000) : 0;
            
            // Save quiz result
            const history = getQuizHistory();
            if (!history[selectedLanguage]) {
                history[selectedLanguage] = [];
            }
            history[selectedLanguage].push({
                score: quizScore,
                total: totalPossibleScore,
                date: new Date().toISOString().split('T')[0] // YYYY-MM-DD
            });
            saveQuizHistory(history);


            showPage('quiz-results-page');
            
            const total = totalPossibleScore;
            finalScoreTextEl.textContent = `${quizScore} / ${total}`;
            finalTimeTakenEl.textContent = `Time Taken: ${formatTime(timeTakenInSeconds)}`;
            
            const percentage = total > 0 ? (quizScore / total) * 100 : 0;
            
            const rotation = (percentage / 100) * 180 - 90;
            speedometerNeedle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;

            if (quizScore >= passingScore) {
                finalMessageEl.innerHTML = `<span class="text-green-400 font-bold">You Passed!</span><br>Excellent work, you're a Python pro!`;
            } else {
                finalMessageEl.innerHTML = `<span class="text-red-400 font-bold">You Failed.</span><br>Keep trying! Revision is key to success.`;
            }
        }

        // --- ANALYTICS FUNCTIONS ---
        function showAnalyticsPage() {
            // 1. Calculate Avg. Quiz Score
            const history = getQuizHistory()[selectedLanguage] || [];
            let totalScore = 0;
            let totalPossible = 0;
            history.forEach(quiz => {
                totalScore += quiz.score;
                totalPossible += quiz.total;
            });
            const avgScore = totalPossible > 0 ? Math.round((totalScore / totalPossible) * 100) : 0;
            avgQuizScoreEl.textContent = `${avgScore}%`;

            // 2. Calculate Cards Reviewed
            const progress = getProgress()[selectedLanguage]?.flashcards || {};
            let reviewedCount = 0;
            for (const deck in progress) {
                reviewedCount += (progress[deck] + 1);
            }
            cardsReviewedEl.textContent = reviewedCount;

            // 3. Render Topic Mastery
            renderTopicMastery();
            
            // 4. Render Learning Curve
            renderLearningCurve();

            showPage('analytics-page');
        }

        function renderTopicMastery() {
            topicMasteryContainer.innerHTML = '';
            const allDecks = getFullDeckData();
            const progress = getProgress()[selectedLanguage]?.flashcards || {};

            for (const deckName in allDecks) {
                const totalCards = allDecks[deckName].length;
                if (totalCards === 0) continue;
                const highestIndexReached = progress[deckName] ?? -1;
                const completedCount = highestIndexReached + 1;
                const percentage = totalCards > 0 ? Math.round((completedCount / totalCards) * 100) : 0;

                let masteryLevel = 'Not Started';
                let masteryColor = 'bg-gray-500';
                if (percentage > 0 && percentage < 50) {
                    masteryLevel = 'Beginner';
                    masteryColor = 'bg-red-500';
                } else if (percentage >= 50 && percentage < 100) {
                    masteryLevel = 'Intermediate';
                    masteryColor = 'bg-yellow-500';
                } else if (percentage >= 100) {
                    masteryLevel = 'Mastered';
                    masteryColor = 'bg-green-500';
                }

                const masteryEl = document.createElement('div');
                masteryEl.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span>${deckName}</span>
                        <span class="text-sm font-semibold text-gray-300 ${masteryColor.replace('bg-', 'text-')}">${masteryLevel}</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2.5">
                        <div class="${masteryColor} h-2.5 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
                topicMasteryContainer.appendChild(masteryEl);
            }
        }

        function renderLearningCurve() {
            const history = getQuizHistory()[selectedLanguage] || [];
            const ctx = document.getElementById('learning-curve-chart').getContext('2d');
            
            const labels = history.map(q => q.date);
            const data = history.map(q => q.total > 0 ? Math.round((q.score / q.total) * 100) : 0);

            if(learningChart) {
                learningChart.destroy();
            }

            learningChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Quiz Score %',
                        data: data,
                        backgroundColor: 'rgba(34, 211, 238, 0.2)',
                        borderColor: 'rgba(34, 211, 238, 1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: '#9ca3af' }
                        },
                        x: {
                            ticks: { color: '#9ca3af' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // --- CUSTOM DECK FUNCTIONS ---
        function showCreateDeckPage() {
            document.getElementById('custom-deck-title').value = '';
            customCardsContainer.innerHTML = '';
            addCardField(); // Add the first card field by default
            showPage('create-deck-page');
        }

        function addCardField(q = '', a = '') {
            const cardField = document.createElement('div');
            cardField.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
            cardField.innerHTML = `
                <textarea placeholder="Question" class="custom-card-q w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500" rows="2">${q}</textarea>
                <textarea placeholder="Answer" class="custom-card-a w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500" rows="2">${a}</textarea>
            `;
            customCardsContainer.appendChild(cardField);
        }

        function saveCustomDeck() {
            const title = document.getElementById('custom-deck-title').value.trim();
            if (!title) {
                alert("Please enter a deck title.");
                return;
            }

            const newDeck = [];
            const cardFields = customCardsContainer.querySelectorAll('.grid');
            cardFields.forEach(field => {
                const q = field.querySelector('.custom-card-q').value.trim();
                const a = field.querySelector('.custom-card-a').value.trim();
                if (q && a) {
                    newDeck.push({ q, a });
                }
            });

            if (newDeck.length === 0) {
                alert("Please add at least one valid card.");
                return;
            }

            const allCustomDecks = getCustomDecks();
            if (!allCustomDecks[selectedLanguage]) {
                allCustomDecks[selectedLanguage] = {};
            }
            allCustomDecks[selectedLanguage][title] = newDeck;
            saveCustomDecks(allCustomDecks);

            alert("Deck saved successfully!");
            populateTopics(selectedLanguage);
            showPage('deck-select-page');
        }

        // --- SEARCH/FILTER FUNCTION ---
        function filterTopics() {
            const query = topicSearchInput.value.toLowerCase().trim();
            const categoryContainers = deckList.querySelectorAll('.deck-category-container');

            categoryContainers.forEach(category => {
                const cards = category.querySelectorAll('.deck-card');
                let categoryHasVisibleCards = false;
                
                cards.forEach(card => {
                    const deckName = card.dataset.deck.toLowerCase();
                    if (deckName.includes(query)) {
                        card.style.display = 'flex';
                        categoryHasVisibleCards = true;
                    } else {
                        card.style.display = 'none';
                    }
                });

                if (categoryHasVisibleCards) {
                    category.style.display = 'block';
                } else {
                    category.style.display = 'none';
                }
            });
        }
        
        // --- EVENT LISTENERS ---
        
        startBtn.addEventListener('click', () => showPage('language-select-page'));

        languageCards.forEach(card => {
            card.addEventListener('click', () => {
                selectedLanguage = card.dataset.lang;
                selectedLanguageName = card.querySelector('span').textContent;
                selectedLangModeSpan.textContent = selectedLanguageName;
                showPage('mode-select-page');
            });
        });

        modeCards.forEach(card => {
            card.addEventListener('click', () => {
                selectedMode = card.dataset.mode;
                loadAndShowFeaturePage();
            });
        });

        function addTopicCardListeners() {
            document.querySelectorAll('.deck-card').forEach(card => {
                card.addEventListener('click', () => {
                    selectedDeck = card.dataset.deck;
                    loadFlashcards();
                    showPage('flashcard-page');
                });
            });
        }
        
        quizDeckBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const deckName = e.currentTarget.dataset.deck;
                showQuizInstructions(deckName);
            });
        });

        startQuizBtn.addEventListener('click', startQuiz);
        endQuizBtn.addEventListener('click', endQuiz);
        tryAgainBtn.addEventListener('click', () => showPage('quiz-deck-select-page'));
        createDeckNavBtn.addEventListener('click', showCreateDeckPage);
        addCardBtn.addEventListener('click', () => addCardField());
        saveDeckBtn.addEventListener('click', saveCustomDeck);
        topicSearchInput.addEventListener('input', filterTopics);
        
        backBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetPageId = e.target.dataset.target;
                if (targetPageId === 'deck-select-page') {
                    populateTopics(selectedLanguage);
                }
                 if (targetPageId === 'mode-select-page') {
                    clearInterval(quizTimerInterval);
                }
                showPage(targetPageId)
            });
        });

        prevBtn.addEventListener('click', prevCard);
        nextBtn.addEventListener('click', nextCard);
        nextDeckBtn.addEventListener('click', goToNextDeck);
        bookmarkBtn.addEventListener('click', toggleBookmark);
        viewBookmarksBtn.addEventListener('click', displayBookmarksPage);
        document.getElementById('flip-btn').addEventListener('click', () => {
            isFlipped = !isFlipped;
            flashcardInner.classList.toggle('is-flipped');
        });
        flashcardInner.addEventListener('click', (e) => {
            if (e.target.closest('a, button')) {
                return;
            }
            isFlipped = !isFlipped;
            flashcardInner.classList.toggle('is-flipped');
        });

        // Event delegation for dynamically added buttons
        document.body.addEventListener('click', function(e) {
            const copyBtn = e.target.closest('.copy-code-btn');
            if (copyBtn) {
                const codeWindow = copyBtn.closest('.code-window');
                const codeEl = codeWindow.querySelector('pre code');
                const codeToCopy = codeEl.innerText;
                const tooltip = copyBtn.querySelector('.copy-tooltip');

                // Fallback for non-secure contexts or older browsers
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = codeToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    tooltip.style.opacity = '1';
                    setTimeout(() => { tooltip.style.opacity = '0'; }, 2000);
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(tempTextArea);
            }
        });

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('flashcard-page').classList.contains('active')) {
                if (e.key === 'ArrowRight') {
                    if (nextBtn.style.display !== 'none') {
                        nextCard();
                    } else if (nextDeckBtn.style.display !== 'none') {
                        goToNextDeck();
                    }
                } else if (e.key === 'ArrowLeft') {
                    prevCard();
                } else if (e.key === ' ' || e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                    e.preventDefault(); // Prevent page scroll
                    isFlipped = !isFlipped;
                    flashcardInner.classList.toggle('is-flipped');
                }
            }
        });

        // --- Typing Animation ---
        function typeEffect() {
            const target = document.getElementById('typing-subtitle');
            if (!target) return;
            const text = "<Level up your code knowledge>";
            let i = 0;
            target.innerHTML = `<span class="typing-cursor" style="height: 1.5rem;"></span>`; // Start with cursor
            
            function type() {
                if (i < text.length) {
                    target.innerHTML = text.substring(0, i + 1) + `<span class="typing-cursor" style="height: 1.5rem;"></span>`;
                    i++;
                    setTimeout(type, 100);
                }
            }
            type();
        }

        // --- Initial Style Setup for Reused Components ---
        function applyStyles() {
            const baseButtonStyles = "text-gray-200 font-bold py-3 px-6 rounded-lg shadow-md";
            document.querySelectorAll('.nav-btn').forEach(btn => btn.className = `${baseButtonStyles} animated-btn btn-gray`);
            
            const cardBaseStyles = "bg-gray-800 p-6 rounded-lg border border-gray-700 hover:border-cyan-400 hover:bg-gray-700 cursor-pointer transition-all duration-200 shadow-lg";
            document.querySelectorAll('.language-card').forEach(card => card.className = `${cardBaseStyles} flex flex-col items-center justify-center text-cyan-400`);
            document.querySelectorAll('.mode-card').forEach(card => card.className = `${cardBaseStyles} text-left`);
            
            const backBtnStyles = "bg-gray-800 text-gray-400 hover:text-cyan-400 border border-gray-700 hover:border-cyan-500 font-semibold py-2 px-5 rounded-lg transition-all duration-200 self-center mt-12 animated-btn";
            const backBtnStyleArray = backBtnStyles.split(' ');
            document.querySelectorAll('.back-btn').forEach(btn => {
                btn.classList.add(...backBtnStyleArray);
            });
        }
        
        // --- INITIAL LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            applyStyles();
            typeEffect();
        });
    </script>
</body>
</html>
